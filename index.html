<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#0d0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Atacad√£o do Sono</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:         #0d0f14;
  --bg2:        #13161e;
  --card:       #181c26;
  --card2:      #1e2333;
  --border:     rgba(255,255,255,0.07);
  --border2:    rgba(255,255,255,0.13);
  --accent:     #7c9cbf;
  --accent2:    #a8c4b8;
  --blue:       #7c9cbf;
  --blue-glow:  rgba(124,156,191,0.2);
  --blue-soft:  rgba(124,156,191,0.1);
  --teal:       #7fbfaa;
  --teal-glow:  rgba(127,191,170,0.18);
  --teal-soft:  rgba(127,191,170,0.08);
  --amber:      #c9a96e;
  --amber-soft: rgba(201,169,110,0.1);
  --green:      #7fbf8a;
  --green-soft: rgba(127,191,138,0.1);
  --red:        #c97070;
  --red-soft:   rgba(201,112,112,0.1);
  --purple:     #9b8abf;
  --purple-soft:rgba(155,138,191,0.1);
  --text:       #dce6f0;
  --text2:      #7a8fa8;
  --text3:      #3a4a5c;
  --radius:     16px;
  --radius-sm:  10px;
  --shadow:     0 2px 16px rgba(0,0,0,0.45);
  --shadow-lg:  0 8px 40px rgba(0,0,0,0.65);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100dvh;overflow-x:hidden}

/* fundo com grade sutil */
body::before{content:'';position:fixed;inset:0;background-image:
  linear-gradient(rgba(124,156,191,0.025) 1px,transparent 1px),
  linear-gradient(90deg,rgba(124,156,191,0.025) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none;z-index:0}

/* orbs de luz */
.glow-orb{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:0}
.glow-orb.blue{width:600px;height:600px;top:-250px;right:-200px;background:radial-gradient(circle,rgba(124,156,191,0.08) 0%,transparent 70%)}
.glow-orb.teal{width:500px;height:500px;bottom:-200px;left:-150px;background:radial-gradient(circle,rgba(127,191,170,0.06) 0%,transparent 70%)}

.container{max-width:680px;margin:0 auto;padding:16px 14px 60px;position:relative;z-index:1}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header{text-align:center;padding:24px 0 20px}
.logo-wrap{display:inline-flex;align-items:center;gap:14px;margin-bottom:8px}
.logo-icon{width:52px;height:52px;background:linear-gradient(135deg,#2a3f5c,#2a4a40);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;box-shadow:0 0 0 1px rgba(255,255,255,0.08),0 0 24px rgba(124,156,191,0.3);flex-shrink:0}
.logo-text h1{font-size:clamp(1.25rem,5vw,1.85rem);font-weight:900;letter-spacing:-1px;line-height:1;background:linear-gradient(120deg,#dce6f0 0%,#a8c4d8 50%,#a8c4b8 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logo-text span{font-size:0.65rem;font-weight:600;color:var(--text3);letter-spacing:3px;text-transform:uppercase;display:block;margin-top:3px}
.header-divider{width:32px;height:2px;background:linear-gradient(90deg,var(--accent),var(--teal));margin:10px auto 0;border-radius:2px;opacity:.5}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs-wrapper{background:rgba(24,28,38,0.9);border:1px solid var(--border);border-radius:var(--radius);padding:4px;display:grid;grid-template-columns:repeat(6,1fr);gap:3px;margin-bottom:20px;box-shadow:var(--shadow);backdrop-filter:blur(10px)}
.tab{padding:9px 4px;border:none;border-radius:12px;background:transparent;color:var(--text2);font-family:'Outfit',sans-serif;font-size:0.72rem;font-weight:600;cursor:pointer;transition:all 0.2s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;letter-spacing:.2px;line-height:1.2}
.tab .ti{font-size:1.1rem;line-height:1}
.tab.active{background:linear-gradient(135deg,rgba(124,156,191,0.18),rgba(127,191,170,0.1));color:var(--text);box-shadow:0 1px 10px rgba(0,0,0,0.5),0 0 0 1px rgba(124,156,191,0.22)}
.panel{display:none}
.panel.active{display:block;animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* ‚îÄ‚îÄ TOTAIS ‚îÄ‚îÄ */
.totais{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.total-card{border-radius:var(--radius);padding:16px 14px;position:relative;overflow:hidden;border:1px solid var(--border)}
.total-card::after{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:50%;filter:blur(30px);pointer-events:none}
.total-card.vendas{background:linear-gradient(135deg,rgba(42,63,92,0.35),rgba(24,28,38,0.9))}
.total-card.vendas::after{background:rgba(124,156,191,0.12)}
.total-card.comissoes{background:linear-gradient(135deg,rgba(42,74,64,0.35),rgba(24,28,38,0.9))}
.total-card.comissoes::after{background:rgba(127,191,170,0.1)}
.tc-icon{font-size:1.15rem;margin-bottom:6px;display:block;opacity:.9}
.tc-label{font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:2.5px;color:var(--text3);margin-bottom:6px}
.tc-value{font-family:'JetBrains Mono',monospace;font-size:clamp(1rem,3.8vw,1.4rem);font-weight:700;line-height:1;letter-spacing:-0.5px}
.total-card.vendas .tc-value{color:#a8c4d8}
.total-card.comissoes .tc-value{color:#a8c4b8}
.tc-count{font-size:0.68rem;color:var(--text3);margin-top:5px;font-family:'JetBrains Mono',monospace}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
.card-title{font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:2.5px;color:var(--text3);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.card-title::after{content:'';flex:1;height:1px;background:var(--border)}

/* ‚îÄ‚îÄ DATE BADGE ‚îÄ‚îÄ */
.date-badge{display:flex;align-items:flex-start;gap:10px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 16px;font-size:0.82rem;font-weight:600;color:var(--text2);margin-bottom:14px;width:100%}
.date-badge .dot{width:7px;height:7px;border-radius:50%;background:#7fbfaa;box-shadow:0 0 7px rgba(127,191,170,0.6);animation:pulse 2s infinite;flex-shrink:0;margin-top:4px}
.badge-info{flex:1;display:flex;flex-direction:column;gap:6px}
.badge-row{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.badge-row span{color:var(--text);font-weight:700;font-size:0.85rem}
.badge-sep{color:var(--text3)!important;font-weight:400!important}
#relogioHoje{font-family:'JetBrains Mono',monospace;font-size:0.83rem!important;color:#7fbfaa!important}
.badge-weather{display:flex;align-items:center;gap:7px;font-size:0.78rem;color:var(--text2);font-weight:500}
.badge-weather span{font-weight:500}
#weatherTemp{font-family:'JetBrains Mono',monospace;color:#a8c4d8;font-weight:700;font-size:0.82rem}
#weatherDesc{color:var(--text3);font-size:0.75rem;text-transform:capitalize}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.7)}}

/* ‚îÄ‚îÄ FIELDS ‚îÄ‚îÄ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.col-full{grid-column:1/-1}
.field-label{display:block;font-size:0.71rem;font-weight:600;color:var(--text2);margin-bottom:5px;letter-spacing:.3px}
.field-input,.field-select{width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:'Outfit',sans-serif;font-size:0.93rem;font-weight:500;padding:11px 13px;outline:none;transition:border-color .18s,box-shadow .18s;-webkit-appearance:none;appearance:none}
.field-input:focus,.field-select:focus{border-color:rgba(124,156,191,.4);box-shadow:0 0 0 3px rgba(124,156,191,.08)}
.field-input.error{border-color:var(--red);box-shadow:0 0 0 3px var(--red-soft);animation:shake .3s ease}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.field-input::placeholder{color:var(--text3)}
.field-select option{background:var(--card)}
input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(0.5) sepia(1) saturate(2) hue-rotate(195deg);cursor:pointer;opacity:.7}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 18px;border:none;border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-weight:700;font-size:0.9rem;cursor:pointer;transition:all .18s cubic-bezier(.4,0,.2,1);letter-spacing:.2px;width:100%;position:relative;overflow:hidden}
.btn-primary{background:linear-gradient(135deg,#2a4a6e,#1e3a52);color:#c8dcea;box-shadow:0 4px 16px rgba(42,74,110,.4);border:1px solid rgba(124,156,191,0.15)}
.btn-primary:hover{background:linear-gradient(135deg,#365e8a,#2a4a6e);box-shadow:0 6px 20px rgba(42,74,110,.5);transform:translateY(-1px)}
.btn-primary:active{transform:scale(.99)}
.btn-teal{background:linear-gradient(135deg,#1e4a40,#1a3d4a);color:#a8c4b8;box-shadow:0 4px 16px rgba(30,74,64,.4);border:1px solid rgba(127,191,170,0.15)}
.btn-teal:hover{background:linear-gradient(135deg,#265e52,#1e4a5c);transform:translateY(-1px)}
.btn-teal:active{transform:scale(.99)}
.btn-amber{background:linear-gradient(135deg,#4a3520,#5c4328);color:#c9a96e;box-shadow:0 4px 16px rgba(74,53,32,.4);border:1px solid rgba(201,169,110,0.18)}
.btn-amber:hover{background:linear-gradient(135deg,#5c4328,#70522e);transform:translateY(-1px)}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{border-color:var(--border2);color:var(--text)}
.btn-danger{background:linear-gradient(135deg,#3d1e1e,#4a2020);color:#c97070;box-shadow:0 4px 16px rgba(61,30,30,.4);border:1px solid rgba(201,112,112,0.15)}
.btn-danger:hover{background:linear-gradient(135deg,#4a2020,#5c2828)}
.btn-green{background:linear-gradient(135deg,#1e4a2a,#1a3d32);color:#a8c4b0;box-shadow:0 4px 16px rgba(30,74,42,.4);border:1px solid rgba(127,191,138,0.15)}
.btn-green:hover{background:linear-gradient(135deg,#265e36,#1e4a3a);transform:translateY(-1px)}

/* ‚îÄ‚îÄ LISTA ‚îÄ‚îÄ */
.lista-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow)}
.lista-header{display:grid;grid-template-columns:minmax(0,2fr) 110px 105px 80px;padding:9px 16px;background:rgba(255,255,255,0.02);border-bottom:1px solid var(--border)}
.lista-header span{font-size:0.6rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--text3)}
.venda-item{display:grid;grid-template-columns:minmax(0,2fr) 110px 105px 80px;align-items:center;padding:11px 16px;border-bottom:1px solid var(--border);transition:background .12s;animation:slideIn .2s ease}
@keyframes slideIn{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:translateX(0)}}
.venda-item:last-child{border-bottom:none}
.venda-item:hover{background:rgba(255,255,255,0.015)}
.venda-desc{font-size:0.82rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:8px;color:var(--text)}
.venda-tag{display:inline-flex;align-items:center;font-size:0.58rem;font-family:'JetBrains Mono',monospace;font-weight:700;padding:2px 6px;border-radius:20px;background:rgba(127,191,170,0.08);color:var(--teal);border:1px solid rgba(127,191,170,0.15);margin-left:5px;vertical-align:middle}
.venda-valor{font-family:'JetBrains Mono',monospace;font-size:0.81rem;font-weight:700;color:#a8c4d8}
.venda-comissao{font-family:'JetBrains Mono',monospace;font-size:0.81rem;font-weight:700;color:#a8c4b8}
.venda-acoes{display:flex;gap:4px}
.btn-sm{width:30px;height:30px;border:1px solid var(--border);border-radius:8px;background:var(--bg2);color:var(--text2);cursor:pointer;font-size:0.75rem;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.btn-sm.edit:hover{border-color:var(--amber);color:var(--amber);background:var(--amber-soft)}
.btn-sm.del:hover{border-color:var(--red);color:var(--red);background:var(--red-soft)}
.lista-empty{padding:40px 20px;text-align:center;color:var(--text3)}
.lista-empty .ei{font-size:2.2rem;margin-bottom:10px;opacity:.25;display:block}
.lista-empty p{font-size:0.84rem;line-height:1.6}

/* ‚îÄ‚îÄ RESUMO BAR ‚îÄ‚îÄ */
.resumo-bar{background:linear-gradient(135deg,rgba(42,74,110,0.1),rgba(42,74,64,0.08));border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-top:12px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;text-align:center}
.rb-label{font-size:0.58rem;font-weight:700;text-transform:uppercase;letter-spacing:1.8px;color:var(--text3);margin-bottom:3px}
.rb-val{font-family:'JetBrains Mono',monospace;font-size:0.88rem;font-weight:700}
.rb-item.total-v .rb-val{color:#a8c4d8}
.rb-item.total-c .rb-val{color:#a8c4b8}
.rb-item.total-n .rb-val{color:var(--text2)}

/* ‚îÄ‚îÄ FECHAR DIA ‚îÄ‚îÄ */
.fechar-dia-wrap{margin-top:12px}
.fechar-dia-btn{background:linear-gradient(135deg,#2a4a6e,#1e4a40);color:#c8dcea;border:1px solid rgba(124,156,191,0.2);border-radius:var(--radius-sm);width:100%;padding:14px;font-family:'Outfit',sans-serif;font-weight:800;font-size:0.95rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:9px;box-shadow:0 4px 20px rgba(42,74,110,.25);letter-spacing:.3px}
.fechar-dia-btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(42,74,110,.35)}
.fechar-dia-btn:active{transform:scale(.99)}

/* ‚îÄ‚îÄ BACKUP SECTION ‚îÄ‚îÄ */
.backup-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.backup-info{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:12px;display:flex;align-items:center;gap:10px;font-size:0.8rem;color:var(--text2)}
.backup-info .bi-icon{font-size:1.2rem}
.backup-info strong{color:var(--text);display:block;font-size:0.82rem;margin-bottom:1px}
.backup-warning{background:rgba(201,169,110,0.05);border:1px solid rgba(201,169,110,0.15);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:12px;display:flex;align-items:flex-start;gap:10px;font-size:0.8rem;color:#c9a96e;line-height:1.5}
.backup-warning .bw-icon{font-size:1.1rem;flex-shrink:0;margin-top:1px}

/* ‚îÄ‚îÄ HIST√ìRICO ‚îÄ‚îÄ */
.mes-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.mes-nav{display:flex;align-items:center;gap:10px}
.mes-nav button{background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text2);cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all .15s}
.mes-nav button:hover{border-color:var(--border2);color:var(--text)}
.mes-titulo{font-family:'JetBrains Mono',monospace;font-size:0.9rem;font-weight:700;color:var(--text);text-transform:capitalize;letter-spacing:.5px}
.hist-resumo{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.hr-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
.hr-label{font-size:0.58rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--text3);margin-bottom:5px}
.hr-val{font-family:'JetBrains Mono',monospace;font-size:0.88rem;font-weight:700;letter-spacing:-0.3px}
.hr-card.hv .hr-val{color:#a8c4d8}
.hr-card.hc .hr-val{color:#a8c4b8}
.hr-card.hn .hr-val{color:var(--text2)}
.hr-card.hm .hr-val{color:#c4b5fd}

.dia-item{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:10px;cursor:pointer;transition:all .15s}
.dia-item:hover{border-color:var(--border2)}
.dia-item.expanded{border-color:rgba(124,156,191,0.22);background:linear-gradient(135deg,rgba(42,74,110,0.1),var(--card))}
.dia-header{display:flex;align-items:center;justify-content:space-between}
.dia-date{font-family:'JetBrains Mono',monospace;font-size:0.84rem;font-weight:700;color:var(--text)}
.dia-badge{display:inline-flex;align-items:center;gap:5px;font-size:0.68rem;font-family:'JetBrains Mono',monospace;padding:3px 9px;border-radius:20px;background:var(--blue-soft);color:#a8c4d8;border:1px solid rgba(124,156,191,0.15)}
.dia-totais{display:flex;gap:14px;margin-top:5px}
.dia-val{font-size:0.77rem;color:var(--text2);font-family:'JetBrains Mono',monospace}
.dia-val span{font-weight:700}
.dia-val span.v{color:#a8c4d8}
.dia-val span.c{color:#a8c4b8}
.dia-chevron{color:var(--text3);font-size:0.8rem;transition:transform .2s}
.dia-item.expanded .dia-chevron{transform:rotate(90deg)}
.dia-vendas{display:none;margin-top:12px;border-top:1px solid var(--border);padding-top:12px}
.dia-item.expanded .dia-vendas{display:block}
.dv-row{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;align-items:center;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.035);font-size:0.8rem}
.dv-row:last-child{border-bottom:none}
.dv-desc{color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dv-val{color:#a8c4d8;font-family:'JetBrains Mono',monospace;font-size:0.78rem;white-space:nowrap}
.dv-com{color:#a8c4b8;font-family:'JetBrains Mono',monospace;font-size:0.78rem;white-space:nowrap}
.dv-acoes{display:flex;gap:4px;flex-shrink:0}
.btn-dv{width:26px;height:26px;border:1px solid var(--border);border-radius:6px;background:var(--bg2);color:var(--text3);cursor:pointer;font-size:0.72rem;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.btn-dv.edit:hover{border-color:var(--amber);color:var(--amber);background:var(--amber-soft)}
.btn-dv.del:hover{border-color:var(--red);color:var(--red);background:var(--red-soft)}
.hist-empty{text-align:center;padding:40px 20px;color:var(--text3);font-size:0.86rem;line-height:1.6}
.hist-empty .ei{font-size:2rem;display:block;margin-bottom:10px;opacity:.25}

/* ‚îÄ‚îÄ GERADOR ‚îÄ‚îÄ */
.prod-row{display:grid;grid-template-columns:58px 1fr 34px;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.prod-row:last-child{border-bottom:none}
.prod-input{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:0.87rem;padding:9px 10px;outline:none;transition:border-color .18s,box-shadow .18s;width:100%}
.prod-input.qtd{text-align:center}
.prod-input:focus{border-color:rgba(124,156,191,.4);box-shadow:0 0 0 3px rgba(124,156,191,.08)}
.prod-input::placeholder{color:var(--text3);font-size:0.77rem}
.btn-del-prod{width:34px;height:34px;background:var(--red-soft);border:1px solid rgba(239,68,68,0.15);border-radius:8px;color:var(--red);cursor:pointer;font-size:0.8rem;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.btn-del-prod:hover{background:rgba(239,68,68,0.18)}
.btn-add-prod{width:100%;margin-top:10px;padding:9px;background:none;border:1px dashed rgba(255,255,255,0.08);border-radius:10px;color:var(--text2);font-family:'Outfit',sans-serif;font-size:0.84rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px}
.btn-add-prod:hover{border-color:rgba(124,156,191,.3);color:#a8c4d8;background:var(--blue-soft)}
.chips{display:flex;flex-wrap:wrap;gap:6px}
.chip{padding:6px 12px;border:1px solid var(--border);border-radius:20px;background:var(--bg2);color:var(--text2);font-family:'JetBrains Mono',monospace;font-size:0.73rem;font-weight:500;cursor:pointer;transition:all .15s;user-select:none}
.chip:hover{border-color:var(--border2);color:var(--text)}
.chip.sel-blue{background:var(--blue-soft);border-color:rgba(124,156,191,.3);color:#a8c4d8;box-shadow:0 0 10px rgba(124,156,191,.1)}
.chip.sel-purple{background:var(--purple-soft);border-color:rgba(155,138,191,.3);color:#b8aed8}
.chip.sel-teal{background:var(--teal-soft);border-color:rgba(127,191,170,.3);color:#a8c4b8}
.preview-wrap{background:#020812;border:1px solid rgba(255,255,255,0.05);border-radius:var(--radius);overflow:hidden;margin-top:14px;box-shadow:var(--shadow-lg)}
.preview-header{background:rgba(255,255,255,0.02);border-bottom:1px solid rgba(255,255,255,0.05);padding:10px 16px;display:flex;align-items:center;justify-content:space-between}
.preview-title{font-size:0.62rem;font-weight:700;text-transform:uppercase;letter-spacing:2.5px;color:var(--text3);display:flex;align-items:center;gap:7px}
.preview-dot{width:5px;height:5px;border-radius:50%;background:#7fbfaa;box-shadow:0 0 5px rgba(127,191,170,0.4);animation:pulse 2s infinite}
.preview-body{padding:18px;font-family:'JetBrains Mono',monospace;font-size:0.81rem;line-height:2;color:#94a3b8;white-space:pre-wrap;min-height:120px}
.btn-copy{width:100%;padding:14px;background:linear-gradient(135deg,#1e4a40,#1a3d4a);border:1px solid rgba(127,191,170,0.2);border-radius:var(--radius-sm);color:#a8c4b8;font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:800;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 16px rgba(30,74,64,.35);letter-spacing:.3px}
.btn-copy:hover{background:linear-gradient(135deg,#265e52,#1e4a5c);transform:translateY(-1px);box-shadow:0 6px 20px rgba(30,74,64,.45)}
.btn-copy.copiado{background:linear-gradient(135deg,#1e4a2a,#1e4a40);box-shadow:0 4px 16px rgba(30,74,42,.4)}
.btn-whatsapp{width:100%;padding:14px;background:linear-gradient(135deg,#1a3d28,#1a3d1a);border:1px solid rgba(37,211,102,0.25);border-radius:var(--radius-sm);color:#86efac;font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:800;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 16px rgba(26,61,26,.4);letter-spacing:.3px;position:relative;overflow:hidden}
.btn-whatsapp::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(255,255,255,0.06),transparent);pointer-events:none}
.btn-whatsapp:hover{background:linear-gradient(135deg,#1e4d30,#1e4d1e);border-color:rgba(37,211,102,0.45);transform:translateY(-1px);box-shadow:0 6px 22px rgba(37,211,102,0.2)}
.btn-whatsapp:active{transform:scale(0.98)}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);z-index:999;align-items:center;justify-content:center;padding:16px}
.overlay.show{display:flex}
.modal{background:var(--card2);border:1px solid var(--border2);border-radius:20px;padding:24px;width:100%;max-width:430px;box-shadow:var(--shadow-lg);animation:modalIn .25s cubic-bezier(.34,1.56,.64,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.92) translateY(14px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-title{font-size:1rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:9px;color:#a8c4d8}
.modal-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--card2);border:1px solid var(--border2);border-radius:12px;padding:11px 20px;font-size:0.84rem;font-weight:600;color:var(--text);box-shadow:var(--shadow-lg);z-index:9999;opacity:0;transition:all .28s cubic-bezier(.34,1.56,.64,1);pointer-events:none;white-space:nowrap;max-width:calc(100vw - 32px)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.success{border-color:rgba(127,191,138,.25);color:#a8c4b0}
.toast.warning{border-color:rgba(201,169,110,.25);color:#c9a96e}

footer{text-align:center;margin-top:24px;padding-bottom:16px;color:var(--text3);font-size:0.68rem;letter-spacing:.5px}
footer span{color:var(--text2)}

@media(max-width:520px){
  .container{padding:12px 12px 80px}
  .tabs-wrapper{grid-template-columns:repeat(6,1fr);padding:3px;gap:2px}
  .tab{padding:8px 2px;font-size:0.62rem;gap:2px}
  .tab .ti{font-size:1rem}
  .lista-header{grid-template-columns:1fr 90px 70px}
  .lista-header .lh-com{display:none}
  .venda-item{grid-template-columns:1fr 90px 70px}
  .venda-comissao{display:none}
  .resumo-bar{grid-template-columns:1fr 1fr}
  .resumo-bar .rb-item.total-n{display:none}
  .form-grid{grid-template-columns:1fr}
  .form-grid .col-full{grid-column:1}
  .hist-resumo{grid-template-columns:1fr 1fr}
  .backup-grid{grid-template-columns:1fr}
  .totais{gap:8px}
  .total-card{padding:14px 12px}
}

/* ‚îÄ‚îÄ VENDAS FUTURAS ‚îÄ‚îÄ */
.fut-filtros{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.fut-filtro{background:var(--bg2);border:1px solid var(--border);border-radius:20px;color:var(--text2);font-size:0.73rem;font-weight:600;padding:6px 14px;cursor:pointer;transition:all .15s;font-family:'JetBrains Mono',monospace}
.fut-filtro:hover{border-color:var(--border2);color:var(--text)}
.fut-filtro.active{background:var(--blue-soft);border-color:rgba(124,156,191,.25);color:#a8c4d8}
.fut-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:10px;transition:border-color .15s}
.fut-card:hover{border-color:var(--border2)}
.fut-card-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:8px}
.fut-cliente{font-size:0.9rem;font-weight:700;color:var(--text);line-height:1.3}
.fut-motivo-badge{font-size:0.62rem;font-family:'JetBrains Mono',monospace;font-weight:700;padding:3px 8px;border-radius:20px;white-space:nowrap;flex-shrink:0}
.fut-motivo-badge.casa{background:rgba(127,191,138,0.1);color:#a8c4b0;border:1px solid rgba(127,191,138,0.2)}
.fut-motivo-badge.prazo{background:rgba(201,169,110,0.08);color:#c9a96e;border:1px solid rgba(201,169,110,0.18)}
.fut-motivo-badge.outros{background:var(--blue-soft);color:#a8c4d8;border:1px solid rgba(124,156,191,0.18)}
.fut-produtos{font-size:0.8rem;color:var(--text2);margin-bottom:8px;line-height:1.5}
.fut-meta{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}
.fut-meta-item{font-size:0.75rem;font-family:'JetBrains Mono',monospace;color:var(--text3);display:flex;align-items:center;gap:4px}
.fut-meta-item strong{color:var(--text2)}
.fut-prazo-urgente{color:#c97070!important}
.fut-prazo-urgente strong{color:#c97070!important}
.fut-card-actions{display:flex;gap:6px;padding-top:10px;border-top:1px solid var(--border)}
.fut-card-actions .btn-sm{width:auto;padding:0 10px;height:28px;font-size:0.72rem;gap:4px;font-family:'Outfit',sans-serif;font-weight:600}
.fut-card-actions .btn-sm.edit:hover{border-color:var(--amber);color:var(--amber);background:var(--amber-soft)}
.fut-card-actions .btn-sm.del:hover{border-color:var(--red);color:var(--red);background:var(--red-soft)}

/* ‚îÄ‚îÄ EFEITOS HOVER / RIPPLE / CLICK ‚îÄ‚îÄ */

/* Ripple gen√©rico nos bot√µes */
.btn{overflow:hidden;position:relative}
.btn::before{content:'';position:absolute;inset:0;background:radial-gradient(circle,rgba(255,255,255,0.12) 0%,transparent 70%);opacity:0;transition:opacity .3s}
.btn:hover::before{opacity:1}
.btn:active{transform:scale(0.975)!important;transition:transform .08s}

/* Tab hover */
.tab:not(.active):hover{background:rgba(255,255,255,0.04);color:var(--text)}
.tab:active{transform:scale(0.95)}

/* Cards hover lift */
.card{transition:border-color .2s,box-shadow .2s,transform .2s}
.card:hover{border-color:var(--border2);box-shadow:0 4px 24px rgba(0,0,0,0.5),0 0 0 1px rgba(124,156,191,0.06)}

/* Total cards hover */
.total-card{transition:border-color .2s,box-shadow .2s,transform .2s;cursor:default}
.total-card:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,0.5)}

/* Lista items hover */
.venda-item{transition:background .15s,padding-left .15s}
.venda-item:hover{background:rgba(124,156,191,0.04)!important;padding-left:20px}

/* Dia items hist√≥rico */
.dia-item{transition:border-color .18s,background .18s,transform .15s}
.dia-item:hover{transform:translateX(3px)}

/* btn-sm hover */
.btn-sm{transition:all .18s cubic-bezier(.4,0,.2,1)}
.btn-sm:active{transform:scale(0.88)}

/* Fechar dia btn */
.fechar-dia-btn{transition:all .2s cubic-bezier(.4,0,.2,1)}
.fechar-dia-btn:active{transform:scale(0.98)!important}

/* Chips */
.chip{transition:all .15s cubic-bezier(.4,0,.2,1)}
.chip:active{transform:scale(0.93)}

/* Fut filtros */
.fut-filtro{transition:all .18s cubic-bezier(.4,0,.2,1)}
.fut-filtro:active{transform:scale(0.93)}

/* Fut cards */
.fut-card{transition:border-color .2s,box-shadow .2s,transform .2s}
.fut-card:not(.entregue):hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,0.45),0 0 0 1px rgba(124,156,191,0.08)}

/* Btn-copy ripple */
.btn-copy{transition:all .2s cubic-bezier(.4,0,.2,1)}
.btn-copy:active{transform:scale(0.98)!important}

/* Btn add prod */
.btn-add-prod{transition:all .2s cubic-bezier(.4,0,.2,1)}
.btn-add-prod:active{transform:scale(0.98)}

/* Hr-cards hist√≥rico */
.hr-card{transition:border-color .18s,background .18s}
.hr-card:hover{border-color:var(--border2);background:rgba(255,255,255,0.025)}

/* ‚îÄ‚îÄ VENDAS FUTURAS ENTREGUES ‚îÄ‚îÄ */
.fut-card.entregue{
  background:linear-gradient(135deg,rgba(42,74,64,0.18),var(--card));
  border-color:rgba(127,191,138,0.2);
  opacity:0.85;
}
.fut-card.entregue .fut-cliente{color:var(--text2)}
.fut-card.entregue .fut-entregue-badge{
  display:inline-flex;align-items:center;gap:5px;
  font-size:0.62rem;font-family:'JetBrains Mono',monospace;font-weight:700;
  padding:3px 9px;border-radius:20px;
  background:rgba(127,191,138,0.12);color:#a8c4b0;
  border:1px solid rgba(127,191,138,0.25);
  flex-shrink:0;
}
.fut-entregue-badge{display:none}

/* Bot√£o confirmar entrega */
.btn-confirmar{
  display:inline-flex;align-items:center;gap:5px;
  height:28px;padding:0 11px;
  background:linear-gradient(135deg,rgba(127,191,138,0.15),rgba(127,191,138,0.08));
  border:1px solid rgba(127,191,138,0.3);
  border-radius:8px;color:#a8c4b0;
  font-family:'Outfit',sans-serif;font-size:0.72rem;font-weight:700;
  cursor:pointer;transition:all .18s cubic-bezier(.4,0,.2,1);
  white-space:nowrap;
}
.btn-confirmar:hover{
  background:linear-gradient(135deg,rgba(127,191,138,0.25),rgba(127,191,138,0.15));
  border-color:rgba(127,191,138,0.5);
  color:#c8e6c8;
  transform:translateY(-1px);
}
.btn-confirmar:active{transform:scale(0.93)}

/* Bot√£o desfazer entrega */
.btn-desfazer{
  display:inline-flex;align-items:center;gap:5px;
  height:28px;padding:0 10px;
  background:transparent;
  border:1px solid var(--border);
  border-radius:8px;color:var(--text3);
  font-family:'Outfit',sans-serif;font-size:0.7rem;font-weight:600;
  cursor:pointer;transition:all .18s;
}
.btn-desfazer:hover{border-color:var(--border2);color:var(--text2)}
.btn-desfazer:active{transform:scale(0.93)}


/* ‚îÄ‚îÄ BOT√ÉO AJUSTES ‚îÄ‚îÄ */
.icon-btn{
  border:1px solid var(--border);
  background:rgba(255,255,255,.04);
  color:var(--text);
  border-radius:14px;
  padding:10px 12px;
  cursor:pointer;
  font-weight:800;
  box-shadow:0 4px 16px rgba(0,0,0,.18);
}
.icon-btn:hover{transform:translateY(-1px)}

/* ‚îÄ‚îÄ CARDS M√äS ‚îÄ‚îÄ */
.insights-wrap{margin-top:12px}
.insights-title{display:flex;align-items:center;justify-content:space-between;margin:10px 2px 8px}
.insights-title h3{margin:0;font-size:0.95rem;letter-spacing:.2px}
.insights-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.ins-card{
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:12px 12px;
  background:linear-gradient(135deg,rgba(42,74,110,0.10),rgba(42,74,64,0.07));
}
.ins-k{font-size:.62rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);font-weight:800}
.ins-v{margin-top:6px;font-family:'JetBrains Mono',monospace;font-size:.92rem;font-weight:800}
.ins-s{margin-top:6px;font-size:.78rem;color:var(--text2);line-height:1.35}

/* ‚îÄ‚îÄ TERM√îMETRO ‚îÄ‚îÄ */
.thermo{
  margin-top:8px;
  height:10px;
  border-radius:999px;
  border:1px solid var(--border);
  overflow:hidden;
  display:flex;
}
.seg{flex:1;opacity:.30}
.seg.active{opacity:1}
.seg.red{background:rgba(255,74,74,.7)}
.seg.yellow{background:rgba(255,214,74,.7)}
.seg.green{background:rgba(92,255,158,.7)}
.seg.fire{background:rgba(255,122,74,.8)}

/* ‚îÄ‚îÄ CONFIG CHECKS ‚îÄ‚îÄ */
.cfg-checks{display:grid;gap:8px;margin-top:6px}
.cfg-checks label{display:flex;gap:10px;align-items:center;font-size:.82rem;color:var(--text2)}

</style>
<body>
<div class="glow-orb blue"></div>
<div class="glow-orb teal"></div>
<div class="toast" id="toast"></div>

<div class="container">

<!-- HEADER -->
<header>
  <div class="logo-wrap">
    <div class="logo-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#a8c4d8" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg></div>
    <div class="logo-text">
      <h1>Atacad√£o do Sono</h1>
      <span>Vendas &amp; Comiss√µes</span>
    </div>
  </div>
  <button class="icon-btn" type="button" onclick="abrirConfig()" title="Ajustes">‚öôÔ∏è</button>
  <div class="header-divider"></div>
</header>

<!-- TABS -->
<div class="tabs-wrapper">
  <button class="tab active" id="tab-somador"   onclick="mudarAba('somador')">  <span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></span>Vendas</button>
  <button class="tab"        id="tab-historico" onclick="mudarAba('historico')"><span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>Hist√≥rico</button>
  <button class="tab"        id="tab-mensagem"  onclick="mudarAba('mensagem')"> <span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></span>Mensagem</button>
  <button class="tab"        id="tab-futuras"   onclick="mudarAba('futuras')">  <span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>Futuras</button>

  <button class="tab"        id="tab-cacador"   onclick="mudarAba('cacador')">  <span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="3" x2="12" y2="6"/><line x1="21" y1="12" x2="18" y2="12"/><line x1="12" y1="21" x2="12" y2="18"/><line x1="3" y1="12" x2="6" y2="12"/></svg></span>Ca√ßador</button>
  <button class="tab"        id="tab-backup"    onclick="mudarAba('backup')">   <span class="ti"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></span>Backup</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 1 ‚Äî SOMADOR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel active" id="panel-somador">

  <div class="date-badge">
    <div class="dot"></div>
    <div class="badge-info">
      <div class="badge-row">
        <span id="dataHoje"></span>
        <span class="badge-sep">¬∑</span>
        <span id="relogioHoje"></span>
      </div>
      <div class="badge-weather" id="weatherRow">
        <span id="weatherIcon">‚è≥</span>
        <span id="weatherTemp"></span>
        <span id="weatherDesc"></span>
      </div>
    </div>
  </div>

  <div class="totais">
    <div class="total-card vendas">
      <span class="tc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a8c4d8" stroke-width="1.7"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></span>
      <div class="tc-label">Total Vendas Hoje</div>
      <div class="tc-value" id="totalVendas">R$ 0,00</div>
      <div class="tc-count" id="qtdVendas">0 vendas</div>
    </div>
    <div class="total-card comissoes">
      <span class="tc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a8c4b8" stroke-width="1.7"><polyline points="8 21 12 17 16 21"/><line x1="12" y1="17" x2="12" y2="11"/><path d="M7 4h10l1 7H6l1-7z"/><path d="M5 4a2 2 0 0 0 0 4"/><path d="M19 4a2 2 0 0 1 0 4"/></svg></span>
      <div class="tc-label">Comiss√µes Hoje</div>
      <div class="tc-value" id="totalComissoes">R$ 0,00</div>
      <div class="tc-count" id="pctMedio">‚Äî m√©dia</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">‚ú¶ Nova Venda</div>
    <div class="form-grid">
      <div class="col-full">
        <label class="field-label">Descri√ß√£o da Venda</label>
        <input class="field-input" id="descricao" type="text" placeholder="Ex: Colch√£o Morfeu + Base ‚Äî Jo√£o Silva" />
      </div>
      <div>
        <label class="field-label">Valor da Venda (R$)</label>
        <input class="field-input" id="valor" type="number" placeholder="0,00" min="0" step="0.01" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Comiss√£o</label>
        <select class="field-select" id="comissao" style="cursor:pointer">
          <option value="3">3%</option>
          <option value="4">4%</option>
          <option value="5" selected>5%</option>
          <option value="6">6%</option>
        </select>
      </div>
      <div class="col-full">
        <label class="field-label">üìÖ Data da Venda <span style="color:var(--red);font-weight:600">*obrigat√≥rio</span></label>
        <input class="field-input" id="dataVenda" type="date" />
      </div>
    </div>
    <button class="btn btn-primary" onclick="adicionarVenda()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Adicionar Venda
    </button>
  </div>

  <div class="lista-card">
    <div class="lista-header">
      <span>Descri√ß√£o</span>
      <span>Venda</span>
      <span class="lh-com">Comiss√£o</span>
      <span>A√ß√µes</span>
    </div>
    <div id="lista">
      <div class="lista-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span><p>Nenhuma venda hoje ainda.<br>Adicione sua primeira venda acima.</p></div>
    </div>
  </div>

  <div class="resumo-bar" id="resumoBar" style="display:none">
    <div class="rb-item total-v"><div class="rb-label">Total Vendas</div><div class="rb-val" id="rbVendas">‚Äî</div></div>
    <div class="rb-item total-c"><div class="rb-label">Total Comiss√£o</div><div class="rb-val" id="rbComissoes">‚Äî</div></div>
    <div class="rb-item total-n"><div class="rb-label">N¬∫ Vendas</div><div class="rb-val" id="rbQtd">‚Äî</div></div>
  </div>

  <div class="insights-wrap" id="insightsWrap" style="display:none">
    <div class="insights-title">
      <h3>üìä Desempenho do m√™s</h3>
    </div>

    <div class="insights-grid">
      <div class="ins-card" id="cardMelhorDia">
        <div class="ins-k">ü•á Melhor dia do m√™s</div>
        <div class="ins-v" id="mdData">‚Äî</div>
        <div class="ins-s" id="mdInfo">‚Äî</div>
      </div>

      <div class="ins-card" id="cardMelhorSemana">
        <div class="ins-k">üèÜ Melhor semana</div>
        <div class="ins-v" id="msSemana">‚Äî</div>
        <div class="ins-s" id="msInfo">‚Äî</div>
      </div>

      <div class="ins-card" id="cardTotalPedidos">
        <div class="ins-k">üì¶ Total de pedidos</div>
        <div class="ins-v" id="tpTotal">‚Äî</div>
        <div class="ins-s" id="tpInfo">‚Äî</div>
      </div>

      <div class="ins-card" id="cardTermometro">
        <div class="ins-k">üå° Term√¥metro</div>
        <div class="ins-v" id="tmValor">‚Äî</div>
        <div class="ins-s" id="tmInfo">‚Äî</div>
        <div class="thermo" aria-hidden="true">
          <div class="seg red" id="segRed"></div>
          <div class="seg yellow" id="segYellow"></div>
          <div class="seg green" id="segGreen"></div>
          <div class="seg fire" id="segFire"></div>
        </div>
      </div>
    </div>
  </div>


  <div class="fechar-dia-wrap" id="fecharDiaWrap" style="display:none">
    <button class="fechar-dia-btn" onclick="fecharDia()">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
      Fechar o Dia de Hoje
    </button>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 2 ‚Äî HIST√ìRICO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 6 ‚Äî CA√áADOR DE COMISS√ÉO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-cacador">

  <div class="card">
    <div class="card-title">üî• Modo Ca√ßador de Comiss√£o</div>
    <div class="muted" style="margin-top:6px">
      Seu painel vira um guia di√°rio: miss√£o, impacto de uma venda e term√¥metro de evolu√ß√£o.
    </div>
  </div>

  <div class="totais" style="margin-top:12px">
    <div class="total-card vendas">
      <div class="tc-label">üéØ Miss√£o do Dia</div>
      <div class="tc-value" id="hunterMissionTitle">‚Äî</div>
      <div class="tc-count" id="hunterMissionSub">‚Äî</div>
    </div>
    <div class="total-card comissoes">
      <div class="tc-label">üèÖ Seu N√≠vel</div>
      <div class="tc-value" id="hunterLevel">‚Äî</div>
      <div class="tc-count" id="hunterLevelSub">‚Äî</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">‚ö° Impacto de uma venda</div>
    <div class="form-grid" style="margin-top:10px">
      <div>
        <label class="field-label">Se eu vender agora (R$)</label>
        <input class="field-input" id="hunterSimValor" type="number" min="0" step="0.01" placeholder="Ex: 2000" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Comiss√£o (%) desta venda</label>
        <select class="field-select" id="hunterSimPct" style="cursor:pointer">
          <option value="3">3%</option>
          <option value="4">4%</option>
          <option value="5" selected>5%</option>
          <option value="6">6%</option>
          <option value="7">7%</option>
        </select>
      </div>
      <div class="col-full">
        <button class="btn primary" onclick="hunterSimular()">Simular</button>
        <button class="btn" onclick="hunterLimparSim()">Limpar</button>
      </div>
    </div>

    <div class="resumo-bar" id="hunterSimBox" style="display:none;margin-top:10px">
      <div class="resumo-line">
        <span class="rk">Resultado</span>
        <span class="rv" id="hunterSimOut">‚Äî</span>
      </div>
      <div class="resumo-line">
        <span class="rk">Novo desempenho</span>
        <span class="rv" id="hunterSimOut2">‚Äî</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üì° Radar</div>
    <div class="muted" id="hunterRadar" style="margin-top:8px">‚Äî</div>
  </div>

</div>

id="panel-historico">

  <div class="mes-header">
    <div class="mes-nav">
      <button onclick="navMes(-1)">&#8249;</button>
      <div class="mes-titulo" id="mesTitulo">‚Äî</div>
      <button onclick="navMes(1)">&#8250;</button>
    </div>
  </div>

  <div class="hist-resumo" id="histResumo">
    <div class="hr-card hv"><div class="hr-label">Vendas no M√™s</div><div class="hr-val" id="hrVendas">R$ 0,00</div></div>
    <div class="hr-card hc"><div class="hr-label">Comiss√£o no M√™s</div><div class="hr-val" id="hrComissoes">R$ 0,00</div></div>
    <div class="hr-card hn"><div class="hr-label">Dias Trabalhados</div><div class="hr-val" id="hrDias">0</div></div>
    <div class="hr-card hm"><div class="hr-label">% M√©dio do M√™s</div><div class="hr-val" id="hrMedia">‚Äî</div></div>
  </div>

  <div id="histLista">
    <div class="hist-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>Nenhum dia fechado ainda.<br>Feche um dia na aba Vendas para ver o hist√≥rico.</div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 3 ‚Äî MENSAGEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-mensagem">

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg> Produtos</div>
    <div id="produtosLista"></div>
    <button class="btn-add-prod" onclick="addProd()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Adicionar produto
    </button>
  </div>

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg> Pagamento</div>
    <div class="chips" id="pgtoChips">
      <button class="chip" onclick="selPgto(this,'√Ä VISTA')">√Ä VISTA</button>
      <button class="chip" onclick="selPgto(this,'PIX')">PIX</button>
      <button class="chip" onclick="selPgto(this,'BLU 2X')">BLU 2X</button>
      <button class="chip" onclick="selPgto(this,'BLU 3X')">BLU 3X</button>
      <button class="chip" onclick="selPgto(this,'BLU 4X')">BLU 4X</button>
      <button class="chip" onclick="selPgto(this,'BLU 5X')">BLU 5X</button>
      <button class="chip" onclick="selPgto(this,'BLU 6X')">BLU 6X</button>
      <button class="chip" onclick="selPgto(this,'BLU 7X')">BLU 7X</button>
      <button class="chip" onclick="selPgto(this,'BLU 8X')">BLU 8X</button>
      <button class="chip" onclick="selPgto(this,'BLU 9X')">BLU 9X</button>
      <button class="chip sel-blue" onclick="selPgto(this,'BLU 10X')">BLU 10X</button>
      <button class="chip" onclick="selPgto(this,'BLU 12X')">BLU 12X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 2X')">CART√ÉO 2X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 3X')">CART√ÉO 3X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 4X')">CART√ÉO 4X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 6X')">CART√ÉO 6X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 10X')">CART√ÉO 10X</button>
      <button class="chip" onclick="selPgto(this,'CART√ÉO 12X')">CART√ÉO 12X</button>
      <button class="chip" onclick="selPgto(this,'BOLETO')">BOLETO</button>
    </div>
    <div style="margin-top:12px">
      <label class="field-label">Ou digitar forma personalizada</label>
      <input class="field-input" id="pgtoCustom" type="text" placeholder="Ex: CHEQUE, BOLETO 3X..." oninput="atualizarMsg()" />
    </div>
  </div>

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg> Detalhes da Venda</div>
    <div class="form-grid">
      <div>
        <label class="field-label">üìÖ Dia da Entrega</label>
        <input class="field-input" id="entrega" type="text" placeholder="FOI HOJE / 25/07..." oninput="atualizarMsg()" />
      </div>
      <div>
        <label class="field-label">Valor da Venda (R$)</label>
        <input class="field-input" id="msgValor" type="number" placeholder="1858.82" step="0.01" inputmode="decimal" oninput="atualizarMsg()" />
      </div>
      <div class="col-full">
        <label class="field-label">üí± Valor Sistema (R$)</label>
        <input class="field-input" id="msgSistema" type="number" placeholder="2186.85" step="0.01" inputmode="decimal" oninput="atualizarMsg()" />
      </div>
    </div>
    <div>
      <label class="field-label" style="margin-bottom:8px">M√≠dia</label>
      <div class="chips" id="midiaChips">
        <button class="chip sel-purple" onclick="selMidia(this,'ENTROU E COMPROU')">ENTROU E COMPROU</button>
        <button class="chip" onclick="selMidia(this,'WHATSAPP')">WHATSAPP</button>
        <button class="chip" onclick="selMidia(this,'INSTAGRAM')">INSTAGRAM</button>
        <button class="chip" onclick="selMidia(this,'FACEBOOK')">FACEBOOK</button>
        <button class="chip" onclick="selMidia(this,'INDICA√á√ÉO')">INDICA√á√ÉO</button>
        <button class="chip" onclick="selMidia(this,'RETORNO')">RETORNO</button>
        <button class="chip" onclick="selMidia(this,'SITE')">SITE</button>
        <button class="chip" onclick="selMidia(this,'GOOGLE')">GOOGLE</button>
        <button class="chip" onclick="selMidia(this,'TIKTOK')">TIKTOK</button>
      </div>
    </div>
  </div>

  <div class="preview-wrap">
    <div class="preview-header">
      <div class="preview-title"><div class="preview-dot"></div>Pr√©via da Mensagem</div>
      <span style="font-size:.63rem;color:var(--text3)">Atualiza em tempo real</span>
    </div>
    <div class="preview-body" id="msgPreview"></div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
    <button class="btn-copy" id="btnCopiar" onclick="copiarMsg()">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
      Copiar
    </button>
    <button class="btn-whatsapp" id="btnWhatsapp" onclick="enviarWhatsapp()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
      WhatsApp
    </button>
  </div>

  <div style="margin-top:10px">
    <button class="btn btn-danger" onclick="limparMsg()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M8 6V4h8v2M19 6l-1 14H6L5 6"/></svg>
      Limpar e nova mensagem
    </button>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 5 ‚Äî VENDAS FUTURAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-futuras">

  <div class="totais" style="margin-bottom:18px">
    <div class="total-card vendas" id="fut-total-card">
      <span class="tc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a8c4d8" stroke-width="1.7"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
      <div class="tc-label">Aguardando Entrega</div>
      <div class="tc-value" id="futTotalQtd">0</div>
      <div class="tc-count" id="futTotalProx">‚Äî pendentes</div>
    </div>
    <div class="total-card comissoes">
      <span class="tc-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a8c4b8" stroke-width="1.7"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
      <div class="tc-label">Aguard. Casa</div>
      <div class="tc-value" id="futQtdCasa" style="color:#86efac">0</div>
      <div class="tc-count" id="futQtdPrazo">0 fabricando</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">‚ú¶ Nova Venda Futura</div>
    <div class="form-grid">
      <div class="col-full">
        <label class="field-label">Cliente</label>
        <input class="field-input" id="futCliente" type="text" placeholder="Nome do cliente" />
      </div>
      <div class="col-full">
        <label class="field-label">Produtos</label>
        <textarea class="field-input" id="futProdutos" rows="3" placeholder="Ex: Colch√£o Casal + Cama Box..." style="resize:vertical;min-height:72px;line-height:1.5"></textarea>
      </div>
      <div>
        <label class="field-label">Prazo de Entrega</label>
        <input class="field-input" id="futPrazo" type="date" />
      </div>
      <div>
        <label class="field-label">Motivo da Espera</label>
        <select class="field-select" id="futMotivo" style="cursor:pointer">
          <option value="">‚Äî Selecione ‚Äî</option>
          <option value="casa">Aguardando Casa</option>
          <option value="prazo">Fabricando / Prazo</option>
          <option value="outros">Outros</option>
        </select>
      </div>
      <div class="col-full">
        <label class="field-label">Observa√ß√£o <span style="color:var(--text3);font-weight:400">(opcional)</span></label>
        <textarea class="field-input" id="futObs" rows="2" placeholder="Detalhes adicionais..." style="resize:vertical;min-height:52px;line-height:1.5"></textarea>
      </div>
    </div>
    <button class="btn btn-primary" onclick="salvarFutura()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      <span id="futBtnTxt">Adicionar Venda Futura</span>
    </button>
  </div>

  <div class="fut-filtros">
    <button class="fut-filtro active" data-filtro="todos" onclick="filtrarFuturas('todos',this)">Todas</button>
    <button class="fut-filtro" data-filtro="pendentes" onclick="filtrarFuturas('pendentes',this)">Pendentes</button>
    <button class="fut-filtro" data-filtro="casa" onclick="filtrarFuturas('casa',this)">Casa</button>
    <button class="fut-filtro" data-filtro="prazo" onclick="filtrarFuturas('prazo',this)">Fabricando</button>
    <button class="fut-filtro" data-filtro="entregues" onclick="filtrarFuturas('entregues',this)">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
      Entregues
    </button>
  </div>

  <div id="fut-lista">
    <div class="lista-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span><p>Nenhuma venda futura cadastrada ainda.<br>Adicione acima para acompanhar.</p></div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ABA 4 ‚Äî BACKUP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-backup">

  <div class="backup-warning">
    <span class="bw-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#c9a96e" stroke-width="1.8"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span>
    <div>
      <strong style="color:#c9a96e;display:block;font-size:0.83rem;margin-bottom:2px">Proteja seus dados!</strong>
      O sistema salva tudo no navegador. Se limpar o cache ou trocar de celular, os dados somem. Fa√ßa backup com frequ√™ncia.
    </div>
  </div>

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Exportar Backup</div>
    <div class="backup-info">
      <span class="bi-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#7a8fa8" stroke-width="1.7"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></span>
      <div>
        <strong id="backupInfoTxt">Carregando...</strong>
        <span>Dados atuais no sistema</span>
      </div>
    </div>
    <div class="backup-grid">
      <button class="btn btn-green" onclick="exportarJSON()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Backup JSON
      </button>
      <button class="btn btn-teal" onclick="exportarCSV()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        Exportar CSV
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg> Restaurar Backup</div>
    <p style="font-size:.82rem;color:var(--text2);margin-bottom:14px;line-height:1.6">
      Selecione um arquivo <strong style="color:var(--text)">.json</strong> exportado anteriormente para restaurar todos os dados. Os dados atuais ser√£o substitu√≠dos.
    </p>
    <label style="display:block">
      <div class="btn btn-amber" style="cursor:pointer" onclick="document.getElementById('fileImport').click()">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Selecionar arquivo de backup
      </div>
      <input type="file" id="fileImport" accept=".json" style="display:none" onchange="importarJSON(event)" />
    </label>
  </div>

  <div class="card">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg> Zona de Perigo</div>
    <p style="font-size:.82rem;color:var(--text2);margin-bottom:14px;line-height:1.6">
      Apaga <strong style="color:var(--red)">permanentemente</strong> todos os dados. Fa√ßa backup antes!
    </p>
    <button class="btn btn-danger" onclick="apagarTudo()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
      Apagar todos os dados
    </button>
  </div>

  <div class="card" style="margin-top:4px">
    <div class="card-title"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg> Instru√ß√µes de Backup</div>
    <div style="font-size:.82rem;color:var(--text2);line-height:1.8">
      <p>1. Clique em <strong style="color:var(--text)">Backup JSON</strong> para baixar um arquivo com todos os seus dados</p>
      <p>2. Guarde o arquivo no Google Drive, WhatsApp ou qualquer lugar seguro</p>
      <p>3. Para restaurar em outro celular: abra o site, v√° em Backup ‚Üí <strong style="color:var(--text)">Selecionar arquivo</strong></p>
      <p style="margin-top:10px;padding:10px;background:var(--bg2);border-radius:8px;border-left:3px solid var(--teal);color:var(--teal)">
        üí° Recomendo fazer backup <strong>toda sexta-feira</strong> antes de sair do trabalho
      </p>
    </div>
  </div>

</div>

</div><!-- /container -->

<!-- MODAL EDI√á√ÉO -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modal-title">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Editar Venda
    </div>
    <div style="margin-bottom:12px">
      <label class="field-label">Descri√ß√£o</label>
      <input class="field-input" id="editDesc" type="text" />
    </div>
    <div class="form-grid">
      <div>
        <label class="field-label">Valor (R$)</label>
        <input class="field-input" id="editValor" type="number" min="0" step="0.01" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Comiss√£o</label>
        <select class="field-select" id="editComissao" style="cursor:pointer">
          <option value="3">3%</option>
          <option value="4">4%</option>
          <option value="5">5%</option>
          <option value="6">6%</option>
        </select>
      </div>
      <div class="col-full">
        <label class="field-label">üìÖ Data da Venda <span style="color:var(--text3);font-weight:400">(muda o dia se necess√°rio)</span></label>
        <input class="field-input" id="editDataVenda" type="date" />
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarEdicao()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Salvar
      </button>
    </div>
  </div>
</div>

<!-- MODAL FECHAR DIA -->
<div class="overlay" id="overlayFechar">
  <div class="modal">
    <div class="modal-title">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg>
      Fechar o Dia
    </div>
    <div style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:16px">
      <div style="font-size:0.75rem;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px">Resumo do dia</div>
      <div id="fecharResumo" style="font-size:0.88rem;line-height:1.9;font-family:'JetBrains Mono',monospace"></div>
    </div>
    <p style="font-size:.82rem;color:var(--text2);line-height:1.6;margin-bottom:4px">
      O dia ser√° salvo no <strong style="color:var(--text)">Hist√≥rico</strong> e as vendas de hoje ser√£o arquivadas. Confirma?
    </p>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharModalFechar()">Cancelar</button>
      <button class="btn btn-green" onclick="confirmarFecharDia()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Fechar o dia
      </button>
    </div>
  </div>
</div>

<!-- MODAL APAGAR VENDA -->
<div class="overlay" id="overlayApagar">
  <div class="modal">
    <div class="modal-title" style="color:#fca5a5">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
      Apagar Venda
    </div>
    <div style="background:var(--red-soft);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:14px;margin-bottom:16px">
      <div style="font-size:0.75rem;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px">Venda a apagar</div>
      <div id="apagarDesc" style="font-size:0.9rem;font-weight:600;color:#fca5a5"></div>
      <div id="apagarValor" style="font-size:0.82rem;color:var(--text2);font-family:'JetBrains Mono',monospace;margin-top:3px"></div>
    </div>
    <p style="font-size:.82rem;color:var(--text2);line-height:1.6;margin-bottom:4px">
      Esta a√ß√£o n√£o pode ser desfeita. Tem certeza?
    </p>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharModalApagar()">Cancelar</button>
      <button class="btn btn-danger" onclick="confirmarApagar()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
        Apagar
      </button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR VENDA DO HIST√ìRICO -->
<div class="overlay" id="overlayEditHist">
  <div class="modal">
    <div class="modal-title">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Editar Venda do Hist√≥rico
    </div>
    <div style="margin-bottom:12px">
      <label class="field-label">Descri√ß√£o</label>
      <input class="field-input" id="editHistDesc" type="text" placeholder="Descri√ß√£o da venda" />
    </div>
    <div class="form-grid">
      <div>
        <label class="field-label">Valor (R$)</label>
        <input class="field-input" id="editHistValor" type="number" min="0" step="0.01" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Comiss√£o</label>
        <select class="field-select" id="editHistComissao" style="cursor:pointer">
          <option value="3">3%</option>
          <option value="4">4%</option>
          <option value="5">5%</option>
          <option value="6">6%</option>
        </select>
      </div>
      <div class="col-full">
        <label class="field-label">üìÖ Data da Venda <span style="color:var(--text3);font-weight:400">(muda o dia se necess√°rio)</span></label>
        <input class="field-input" id="editHistData" type="date" />
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharEditHist()">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarEdicaoHist()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Salvar
      </button>
    </div>
  </div>
</div>

<!-- MODAL APAGAR VENDA DO HIST√ìRICO -->
<div class="overlay" id="overlayApagarHist">
  <div class="modal">
    <div class="modal-title" style="color:#fca5a5">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
      Apagar Venda do Hist√≥rico
    </div>
    <div style="background:var(--red-soft);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:14px;margin-bottom:16px">
      <div style="font-size:0.75rem;color:var(--text3);font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px">Venda a apagar</div>
      <div id="apagarHistDesc" style="font-size:0.9rem;font-weight:600;color:#fca5a5"></div>
      <div id="apagarHistValor" style="font-size:0.8rem;color:var(--text2);font-family:'JetBrains Mono',monospace;margin-top:4px"></div>
    </div>
    <p style="font-size:.82rem;color:var(--text2);line-height:1.6;margin-bottom:4px">
      Esta a√ß√£o n√£o pode ser desfeita. Tem certeza?
    </p>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharApagarHist()">Cancelar</button>
      <button class="btn btn-danger" onclick="confirmarApagarHist()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
        Apagar
      </button>
    </div>
  </div>
</div>


<!-- MODAL AJUSTES -->
<div class="overlay" id="overlayCfg" style="display:none">
  <div class="modal">
    <div class="modal-title">
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/><circle cx="12" cy="12" r="3"/></svg>
      Ajustes
    </div>

    <div style="margin-bottom:12px">
      <label class="field-label">Base do term√¥metro</label>
      <select class="field-select" id="cfgBase" style="cursor:pointer">
        <option value="comissao">Comiss√£o (recomendado)</option>
        <option value="vendas">Vendas</option>
      </select>
    </div>

    <div class="form-grid">
      <div>
        <label class="field-label">Meta de crescimento (%)</label>
        <input class="field-input" id="cfgMeta" type="number" min="0" step="0.1" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Excelente a partir de (%)</label>
        <input class="field-input" id="cfgExcelente" type="number" min="0" step="0.1" inputmode="decimal" />
      </div>
      <div>
        <label class="field-label">Meta mensal (R$) ‚Äî opcional</label>
        <input class="field-input" id="cfgMetaMensal" type="number" min="0" step="0.01" inputmode="decimal" placeholder="Ex: 2500"/>
      </div>
      <div>
        <label class="field-label">Mostrar aba Ca√ßador</label>
        <select class="field-select" id="cfgShowCacador" style="cursor:pointer">
          <option value="1">Sim</option>
          <option value="0">N√£o</option>
        </select>
      </div>

      <div class="col-full">
        <label class="field-label">Mostrar cards</label>
        <div class="cfg-checks">
          <label><input type="checkbox" id="cfgShowDia"> Melhor dia do m√™s</label>
          <label><input type="checkbox" id="cfgShowSemana"> Melhor semana</label>
          <label><input type="checkbox" id="cfgShowPedidos"> Total de pedidos</label>
          <label><input type="checkbox" id="cfgShowTermo"> Term√¥metro</label>
        </div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="fecharConfig()">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarConfig()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Salvar
      </button>
    </div>
  </div>
</div>


<footer>
  Atacad√£o do Sono &nbsp;¬∑&nbsp; <span>Dados salvos localmente</span> &nbsp;¬∑&nbsp; Funciona em qualquer dispositivo
</footer>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UTILS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const R = id => document.getElementById(id);
const brl = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const numBrl = n => (!n && n!==0) ? '___' : parseFloat(n).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});
const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const arred = v => Math.round(v*100)/100;

function toast(msg, tipo='success', dur=3000){
  const t = R('toast');
  t.textContent = msg;
  t.className = `toast show ${tipo}`;
  setTimeout(()=>t.classList.remove('show'), dur);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function dataHoje(){
  const d = new Date();
  return d.toISOString().slice(0,10); // YYYY-MM-DD
}

function fmtData(iso){
  const [y,m,d] = iso.split('-');
  const meses = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
  const dias  = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
  const dt = new Date(y, m-1, d);
  return `${dias[dt.getDay()]}, ${d} ${meses[m-1]} ${y}`;
}

function fmtMes(ano, mes){
  const meses = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
  return `${meses[mes-1]} ${ano}`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STORAGE ‚Äî estrutura:
   atac_vendas_hoje : { data: 'YYYY-MM-DD', itens: [...] }
   atac_historico   : { 'YYYY-MM-DD': { data, itens, totalVendas, totalCom } }
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadHoje(){
  const raw = localStorage.getItem('atac_hoje');
  if(!raw) return { data: dataHoje(), itens: [] };
  const obj = JSON.parse(raw);
  // se o dia mudou desde a √∫ltima sess√£o, come√ßa novo (avisa usu√°rio se havia vendas)
  if(obj.data !== dataHoje()){
    // mant√©m mas n√£o auto-fecha ‚Äî usu√°rio decide
    return { data: obj.data, itens: obj.itens, diaAnterior: true };
  }
  return obj;
}

function saveHoje(obj){ localStorage.setItem('atac_hoje', JSON.stringify(obj)); }

function loadHist(){
  const raw = localStorage.getItem('atac_hist');
  return raw ? JSON.parse(raw) : {};
}

function saveHist(h){ localStorage.setItem('atac_hist', JSON.stringify(h)); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ABAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const abas = ['somador','cacador','historico','mensagem','futuras','backup'];
function mudarAba(aba){
  abas.forEach(a=>{
    R('tab-'+a).classList.toggle('active', a===aba);
    R('panel-'+a).classList.toggle('active', a===aba);
  });
  if(aba==='historico') renderHistorico();
  if(aba==='backup')    atualizarBackupInfo();
  if(aba==='futuras')   renderFuturas();
  if(aba==='cacador')   hunterRender();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SOMADOR
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let hoje = loadHoje();
let editIdx = null;

// Aviso se virou o dia
window.addEventListener('load', ()=>{
  loadCfg();
  applyCacadorVisibility();
  if(hoje.diaAnterior && hoje.itens.length > 0){
    toast(`‚ö†Ô∏è Vendas de ${fmtData(hoje.data)} n√£o fechadas. Feche o dia ou continue.`, 'warning', 6000);
  }
  R('dataHoje').textContent = fmtData(hoje.diaAnterior ? hoje.data : dataHoje());
  renderLista();
  renderProds();
  atualizarMsg();
  addProd('01','');
  addProd('01','');
  iniciarRelogio();
  buscarClima();
});

/* ‚îÄ‚îÄ REL√ìGIO ‚îÄ‚îÄ */
function iniciarRelogio(){
  function tick(){
    const agora = new Date();
    const h = String(agora.getHours()).padStart(2,'0');
    const m = String(agora.getMinutes()).padStart(2,'0');
    const s = String(agora.getSeconds()).padStart(2,'0');
    const el = R('relogioHoje');
    if(el) el.textContent = `${h}:${m}:${s}`;
  }
  tick();
  setInterval(tick, 1000);
}

/* ‚îÄ‚îÄ CLIMA ‚Äî Formosa, Goi√°s (lat:-15.53, lon:-47.33) ‚îÄ‚îÄ */
async function buscarClima(){
  try {
    // Open-Meteo ‚Äî gratuito, sem chave de API
    const url = 'https://api.open-meteo.com/v1/forecast?latitude=-15.5328&longitude=-47.3328&current=temperature_2m,weathercode&timezone=America%2FSao_Paulo';
    const res  = await fetch(url);
    const data = await res.json();
    const temp = Math.round(data.current.temperature_2m);
    const code = data.current.weathercode;
    const { icon, desc } = climaDesc(code);
    R('weatherIcon').textContent = icon;
    R('weatherTemp').textContent = `${temp}¬∞C`;
    R('weatherDesc').textContent = `¬∑ ${desc} ¬∑ Formosa-GO`;
  } catch(e) {
    R('weatherIcon').textContent = '‚Äî';
    R('weatherTemp').textContent = '';
    R('weatherDesc').textContent = 'clima indispon√≠vel';
  }
}

function climaDesc(code){
  if(code===0)               return { icon:'‚òÄÔ∏è', desc:'C√©u limpo' };
  if(code<=2)                return { icon:'üå§Ô∏è', desc:'Parcialmente nublado' };
  if(code<=3)                return { icon:'‚òÅÔ∏è', desc:'Nublado' };
  if(code<=49)               return { icon:'üå´Ô∏è', desc:'N√©voa/neblina' };
  if(code<=59)               return { icon:'üå¶Ô∏è', desc:'Chuvisco' };
  if(code<=69)               return { icon:'üåßÔ∏è', desc:'Chuva' };
  if(code<=79)               return { icon:'üå®Ô∏è', desc:'Neve/granizo' };
  if(code<=82)               return { icon:'üåßÔ∏è', desc:'Chuva forte' };
  if(code<=99)               return { icon:'‚õàÔ∏è', desc:'Tempestade' };
  return { icon:'üå°Ô∏è', desc:'‚Äî' };
}

function calcTotais(){
  let sv=0, sc=0;
  for(const v of hoje.itens){
    sv += v.valor;
    sc += arred(v.valor * v.comissao / 100);
  }
  return { sv: arred(sv), sc: arred(sc) };
}

function renderLista(){
  const {sv, sc} = calcTotais();
  const n = hoje.itens.length;

  R('totalVendas').textContent   = brl(sv);
  R('totalComissoes').textContent = brl(sc);
  R('qtdVendas').textContent = n===0?'0 vendas':n===1?'1 venda':`${n} vendas`;
  R('pctMedio').textContent  = (n>0&&sv>0) ? `${((sc/sv)*100).toFixed(2)}% m√©dio` : '‚Äî m√©dia';
  R('resumoBar').style.display = n>0?'grid':'none';
  R('fecharDiaWrap').style.display = n>0?'block':'none';
  R('rbVendas').textContent    = brl(sv);
  R('rbComissoes').textContent  = brl(sc);
  R('rbQtd').textContent       = n;

  const lista = R('lista');
  if(!n){
    lista.innerHTML=`<div class="lista-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></span><p>Nenhuma venda hoje ainda.<br>Adicione sua primeira venda acima.</p></div>`;
    return;
  }
  lista.innerHTML = hoje.itens.map((v,i)=>{
    const com = arred(v.valor * v.comissao / 100);
    return `<div class="venda-item">
      <span class="venda-desc">${esc(v.desc)}<span class="venda-tag">${v.comissao}%</span></span>
      <span class="venda-valor">${brl(v.valor)}</span>
      <span class="venda-comissao">${brl(com)}</span>
      <div class="venda-acoes">
        <button class="btn-sm edit" title="Editar" onclick="editarVenda(${i})">‚úèÔ∏è</button>
        <button class="btn-sm del"  title="Apagar" onclick="apagarVenda(${i})">üóëÔ∏è</button>
      </div>
    </div>`;
  }).join('');

  renderInsightsMes();
}

function adicionarVenda(){
  const desc      = R('descricao').value.trim();
  const raw       = R('valor').value.trim();
  const valor     = parseFloat(raw);
  const com       = parseInt(R('comissao').value);
  const dataInput = R('dataVenda').value;

  // Valida√ß√£o ‚Äî valor obrigat√≥rio
  if(!raw||isNaN(valor)||valor<=0){
    R('valor').classList.add('error');
    R('valor').focus();
    setTimeout(()=>R('valor').classList.remove('error'),800);
    return;
  }

  // Valida√ß√£o ‚Äî data obrigat√≥ria
  if(!dataInput){
    R('dataVenda').classList.add('error');
    R('dataVenda').focus();
    toast('‚ö†Ô∏è Preencha a data da venda!','warning');
    setTimeout(()=>R('dataVenda').classList.remove('error'),800);
    return;
  }

  const dataVenda = dataInput;

  // Se a data √© diferente do dia em aberto, vai direto para o hist√≥rico
  if(dataVenda !== hoje.data){
    const hist = loadHist();
    if(!hist[dataVenda]) hist[dataVenda] = { data: dataVenda, itens: [], totalVendas: 0, totalCom: 0 };
    const novaVenda = { desc: desc||'Venda sem descri√ß√£o', valor: arred(valor), comissao: com, ts: Date.now() };
    hist[dataVenda].itens.push(novaVenda);
    let sv=0, sc=0;
    for(const v of hist[dataVenda].itens){ sv+=v.valor; sc+=arred(v.valor*v.comissao/100); }
    hist[dataVenda].totalVendas = arred(sv);
    hist[dataVenda].totalCom    = arred(sc);
    saveHist(hist);
    toast(`‚úÖ Venda lan√ßada em ${fmtData(dataVenda)}!`);
  } else {
    hoje.itens.push({ desc: desc||'Venda sem descri√ß√£o', valor: arred(valor), comissao: com, ts: Date.now() });
    saveHoje(hoje);
    renderLista();
    preencherMensagem(desc||'Venda sem descri√ß√£o', arred(valor));
    toast('‚úÖ Venda adicionada! Mensagem preenchida üì©');
  }

  R('descricao').value='';
  R('valor').value='';
  R('dataVenda').value='';
  R('valor').focus();
}

// ‚îÄ‚îÄ Apagar venda ‚Äî usa modal pr√≥prio (sem confirm() nativo) ‚îÄ‚îÄ
let apagarIdx = null;

function apagarVenda(i){
  apagarIdx = i;
  const v = hoje.itens[i];
  R('apagarDesc').textContent  = v.desc;
  R('apagarValor').textContent = `${brl(v.valor)} ¬∑ ${v.comissao}% = ${brl(arred(v.valor*v.comissao/100))}`;
  R('overlayApagar').classList.add('show');
}

function fecharModalApagar(){ R('overlayApagar').classList.remove('show'); apagarIdx=null; }

function confirmarApagar(){
  if(apagarIdx===null) return;
  hoje.itens.splice(apagarIdx,1);
  saveHoje(hoje);
  renderLista();
  fecharModalApagar();
  toast('üóëÔ∏è Venda removida','warning');
}

function editarVenda(i){
  editIdx=i;
  R('editDesc').value      = hoje.itens[i].desc;
  R('editValor').value     = hoje.itens[i].valor;
  R('editComissao').value  = hoje.itens[i].comissao;
  R('editDataVenda').value = hoje.data; // preenche com a data atual do bloco
  R('overlay').classList.add('show');
}

function fecharModal(){ R('overlay').classList.remove('show'); editIdx=null; }

function salvarEdicao(){
  if(editIdx===null) return;
  const valor    = parseFloat(R('editValor').value);
  const novaData = R('editDataVenda').value || hoje.data;
  if(isNaN(valor)||valor<=0) return;

  const vendaAtualizada = {
    desc:     R('editDesc').value.trim()||'Venda sem descri√ß√£o',
    valor:    arred(valor),
    comissao: parseInt(R('editComissao').value),
    ts:       hoje.itens[editIdx].ts
  };

  if(novaData !== hoje.data){
    // Mover para outro dia no hist√≥rico
    hoje.itens.splice(editIdx, 1);
    saveHoje(hoje);
    const hist = loadHist();
    if(!hist[novaData]) hist[novaData] = { data: novaData, itens: [], totalVendas: 0, totalCom: 0 };
    hist[novaData].itens.push(vendaAtualizada);
    recalcDia(hist, novaData);
    saveHist(hist);
    toast(`‚úÖ Venda movida para ${fmtData(novaData)}!`);
  } else {
    hoje.itens[editIdx] = vendaAtualizada;
    saveHoje(hoje);
    toast('‚úÖ Venda atualizada!');
  }

  renderLista(); fecharModal();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FECHAR DIA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function fecharDia(){
  if(!hoje.itens.length){ toast('Sem vendas para fechar!','warning'); return; }
  const {sv,sc} = calcTotais();
  const n = hoje.itens.length;
  R('fecharResumo').innerHTML =
    `<span style="color:var(--text2)">üìÖ Data:</span> <span style="color:var(--text)">${fmtData(hoje.data)}</span>\n`+
    `<span style="color:var(--text2)">üõí Vendas:</span> <span style="color:#93c5fd">${n} venda${n!==1?'s':''}</span>\n`+
    `<span style="color:var(--text2)">Total:</span> <span style="color:#a8c4d8">${brl(sv)}</span>\n`+
    `<span style="color:var(--text2)">Comiss√£o:</span> <span style="color:#a8c4b8">${brl(sc)}</span>`;
  R('overlayFechar').classList.add('show');
}

function fecharModalFechar(){ R('overlayFechar').classList.remove('show'); }

function confirmarFecharDia(){
  const {sv,sc} = calcTotais();
  const hist = loadHist();
  // Salva no hist√≥rico (se j√° existe esse dia, mescla)
  hist[hoje.data] = {
    data: hoje.data,
    itens: [...hoje.itens],
    totalVendas: sv,
    totalCom: sc
  };
  saveHist(hist);
  // Limpa hoje com nova data
  hoje = { data: dataHoje(), itens: [] };
  saveHoje(hoje);
  renderLista();
  fecharModalFechar();
  R('dataHoje').textContent = fmtData(dataHoje());
  toast('‚úÖ Dia fechado e salvo no hist√≥rico!');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HIST√ìRICO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let histMesAno = { ano: new Date().getFullYear(), mes: new Date().getMonth()+1 };

function navMes(dir){
  histMesAno.mes += dir;
  if(histMesAno.mes > 12){ histMesAno.mes=1; histMesAno.ano++; }
  if(histMesAno.mes < 1) { histMesAno.mes=12; histMesAno.ano--; }
  renderHistorico();
}

function renderHistorico(){
  const {ano,mes} = histMesAno;
  R('mesTitulo').textContent = fmtMes(ano,mes);
  const hist = loadHist();
  const prefixo = `${ano}-${String(mes).padStart(2,'0')}`;
  const dias = Object.keys(hist).filter(k=>k.startsWith(prefixo)).sort().reverse();

  let totV=0, totC=0;
  dias.forEach(d=>{ totV+=hist[d].totalVendas; totC+=hist[d].totalCom; });
  R('hrVendas').textContent    = brl(arred(totV));
  R('hrComissoes').textContent = brl(arred(totC));
  R('hrDias').textContent      = dias.length;
  R('hrMedia').textContent     = (totV>0) ? ((arred(totC)/arred(totV)*100).toFixed(2)+'%') : '‚Äî';

  const el = R('histLista');
  if(!dias.length){
    el.innerHTML=`<div class="hist-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>Nenhum dia fechado em ${fmtMes(ano,mes)}.<br>Feche um dia na aba Vendas para ver aqui.</div>`;
    return;
  }
  el.innerHTML = dias.map(d=>{
    const dh = hist[d];
    const n  = dh.itens.length;
    const vendasRows = dh.itens.map((v,vi)=>{
      const com = arred(v.valor * v.comissao/100);
      return `<div class="dv-row">
        <span class="dv-desc" title="${esc(v.desc)}">${esc(v.desc)}</span>
        <span class="dv-val">${brl(v.valor)}</span>
        <span class="dv-com">${brl(com)}</span>
        <div class="dv-acoes">
          <button class="btn-dv edit" title="Editar" onclick="event.stopPropagation();editarVendaHist('${d}',${vi})">‚úèÔ∏è</button>
          <button class="btn-dv del"  title="Apagar" onclick="event.stopPropagation();apagarVendaHist('${d}',${vi})">üóëÔ∏è</button>
        </div>
      </div>`;
    }).join('');
    return `<div class="dia-item" onclick="toggleDia(this)">
      <div class="dia-header">
        <div>
          <div class="dia-date">${fmtData(d)}</div>
          <div class="dia-totais">
            <span class="dia-val">Vendas: <span class="v">${brl(dh.totalVendas)}</span></span>
            <span class="dia-val">Com: <span class="c">${brl(dh.totalCom)}</span></span>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="dia-badge">${n} venda${n!==1?'s':''}</span>
          <span class="dia-chevron">‚Ä∫</span>
        </div>
      </div>
      <div class="dia-vendas">${vendasRows}</div>
    </div>`;
  }).join('');

  renderInsightsMes();
}

function toggleDia(el){ el.classList.toggle('expanded'); }

/* ‚îÄ‚îÄ Editar/Apagar vendas do HIST√ìRICO ‚îÄ‚îÄ */
let histEditData = null, histEditIdx = null;
let histApagarData = null, histApagarIdx = null;

function editarVendaHist(data, idx){
  const hist = loadHist();
  const v = hist[data].itens[idx];
  histEditData = data;
  histEditIdx  = idx;
  R('editHistDesc').value    = v.desc;
  R('editHistValor').value   = v.valor;
  R('editHistComissao').value= v.comissao;
  R('editHistData').value    = data;
  R('overlayEditHist').classList.add('show');
}

function fecharEditHist(){ R('overlayEditHist').classList.remove('show'); histEditData=null; histEditIdx=null; }

function salvarEdicaoHist(){
  if(histEditData===null || histEditIdx===null) return;
  const novaDesc  = R('editHistDesc').value.trim() || 'Venda sem descri√ß√£o';
  const novoValor = parseFloat(R('editHistValor').value);
  const novaCom   = parseInt(R('editHistComissao').value);
  const novaData  = R('editHistData').value;
  if(isNaN(novoValor)||novoValor<=0) return;

  const hist = loadHist();
  const venda = { ...hist[histEditData].itens[histEditIdx], desc:novaDesc, valor:arred(novoValor), comissao:novaCom };

  // Se a data mudou, move a venda de dia
  if(novaData && novaData !== histEditData){
    // Remove do dia original
    hist[histEditData].itens.splice(histEditIdx, 1);
    recalcDia(hist, histEditData);
    // Se dia ficou vazio, remove
    if(hist[histEditData].itens.length === 0) delete hist[histEditData];
    // Adiciona no novo dia
    if(!hist[novaData]) hist[novaData] = { data: novaData, itens: [], totalVendas: 0, totalCom: 0 };
    hist[novaData].itens.push(venda);
    recalcDia(hist, novaData);
  } else {
    hist[histEditData].itens[histEditIdx] = venda;
    recalcDia(hist, histEditData);
  }

  saveHist(hist);
  fecharEditHist();
  renderHistorico();
  toast('‚úÖ Venda atualizada no hist√≥rico!');
}

function apagarVendaHist(data, idx){
  const hist = loadHist();
  const v = hist[data].itens[idx];
  histApagarData = data;
  histApagarIdx  = idx;
  R('apagarHistDesc').textContent  = v.desc;
  R('apagarHistValor').textContent = `${brl(v.valor)} ¬∑ ${v.comissao}% = ${brl(arred(v.valor*v.comissao/100))} ¬∑ ${fmtData(data)}`;
  R('overlayApagarHist').classList.add('show');
}

function fecharApagarHist(){ R('overlayApagarHist').classList.remove('show'); histApagarData=null; histApagarIdx=null; }

function confirmarApagarHist(){
  if(histApagarData===null || histApagarIdx===null) return;
  const hist = loadHist();
  hist[histApagarData].itens.splice(histApagarIdx, 1);
  recalcDia(hist, histApagarData);
  if(hist[histApagarData].itens.length === 0) delete hist[histApagarData];
  saveHist(hist);
  fecharApagarHist();
  renderHistorico();
  toast('üóëÔ∏è Venda removida do hist√≥rico','warning');
}

function recalcDia(hist, data){
  if(!hist[data]) return;
  let sv=0, sc=0;
  for(const v of hist[data].itens){ sv+=v.valor; sc+=arred(v.valor*v.comissao/100); }
  hist[data].totalVendas = arred(sv);
  hist[data].totalCom    = arred(sc);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BACKUP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function atualizarBackupInfo(){
  const hist = loadHist();
  const dias = Object.keys(hist).length;
  const totalItens = Object.values(hist).reduce((s,d)=>s+d.itens.length,0) + hoje.itens.length;
  R('backupInfoTxt').textContent = `${dias} dia${dias!==1?'s':''} fechados ¬∑ ${totalItens} vendas no total`;
}

function exportarJSON(){
  const data = {
    versao: '3.0',
    exportadoEm: new Date().toISOString(),
    hoje: hoje,
    historico: loadHist(),
    futuras: loadFuturas()
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  const data_str = new Date().toISOString().slice(0,10);
  a.href = url;
  a.download = `atacadao-backup-${data_str}.json`;
  a.click();
  URL.revokeObjectURL(url);
  toast('‚úÖ Backup JSON exportado!');
}

function exportarCSV(){
  const hist = loadHist();
  const linhas = [['Data','Descri√ß√£o','Valor','Comiss√£o %','Comiss√£o R$']];
  // vendas do hist√≥rico
  Object.values(hist).sort((a,b)=>a.data.localeCompare(b.data)).forEach(d=>{
    d.itens.forEach(v=>{
      const com = arred(v.valor*v.comissao/100);
      linhas.push([fmtData(d.data), v.desc, v.valor.toFixed(2).replace('.',','), v.comissao+'%', com.toFixed(2).replace('.',',')]);
    });
  });
  // vendas de hoje (n√£o fechadas)
  if(hoje.itens.length){
    hoje.itens.forEach(v=>{
      const com = arred(v.valor*v.comissao/100);
      linhas.push([fmtData(hoje.data)+' (aberto)', v.desc, v.valor.toFixed(2).replace('.',','), v.comissao+'%', com.toFixed(2).replace('.',',')]);
    });
  }
  const csv = '\uFEFF' + linhas.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(';')).join('\r\n');
  const blob = new Blob([csv],{type:'text/csv;charset=utf-8'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href=url; a.download=`atacadao-vendas-${new Date().toISOString().slice(0,10)}.csv`; a.click();
  URL.revokeObjectURL(url);
  toast('‚úÖ CSV exportado! Abra no Excel.');
}

function importarJSON(ev){
  const file = ev.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try{
      const data = JSON.parse(e.target.result);
      // aceita tanto vers√£o antiga (s√≥ historico) quanto nova
      if(!data.historico && !data.hoje) throw new Error('Arquivo inv√°lido');
      const dataExp = data.exportadoEm ? new Date(data.exportadoEm).toLocaleDateString('pt-BR') : '?';
      const dias = Object.keys(data.historico||{}).length;
      const futQtd = (data.futuras||[]).length;
      if(!window.confirm(`Restaurar backup de ${dataExp}?\n${dias} dia(s) de hist√≥rico ¬∑ ${futQtd} venda(s) futura(s) no arquivo.\n\nIsso vai substituir TODOS os dados atuais.`)) return;
      if(data.historico) saveHist(data.historico);
      if(data.hoje){ hoje = data.hoje; saveHoje(hoje); }
      if(data.futuras) saveFuturas(data.futuras);
      renderLista();
      toast('‚úÖ Backup restaurado com sucesso!');
      atualizarBackupInfo();
    } catch(err){
      toast('‚ùå Arquivo inv√°lido ou corrompido. Certifique-se que √© um .json exportado pelo sistema.','warning',5000);
    }
    ev.target.value='';
  };
  reader.readAsText(file, 'UTF-8');
}

function apagarTudo(){
  if(!window.confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apaga TODOS os dados permanentemente.\n\nFa√ßa backup antes!\n\nTem certeza?')) return;
  localStorage.removeItem('atac_hoje');
  localStorage.removeItem('atac_hist');
  localStorage.removeItem(FUTURAS_KEY);
  hoje = { data: dataHoje(), itens: [] };
  saveHoje(hoje);
  renderLista();
  atualizarBackupInfo();
  toast('üóëÔ∏è Todos os dados apagados','warning');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   GERADOR DE MENSAGEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let pgto='BLU 10X', midia='ENTROU E COMPROU';
let prods=[], pid=0;

function addProd(qtd='',nome=''){
  prods.push({id:++pid,qtd,nome});
  renderProds(); atualizarMsg();
}
function remProd(id){
  prods=prods.filter(p=>p.id!==id);
  renderProds(); atualizarMsg();
}
function updProd(id,campo,val){
  const p=prods.find(p=>p.id===id);
  if(p) p[campo]=val;
  atualizarMsg();
}
function renderProds(){
  const el=R('produtosLista');
  if(!prods.length){
    el.innerHTML=`<div style="color:var(--text3);font-size:.82rem;padding:10px 0;text-align:center">Clique em "+ Adicionar produto"</div>`;
    return;
  }
  el.innerHTML=prods.map(p=>`
    <div class="prod-row">
      <input class="prod-input qtd" type="number" placeholder="Qtd" value="${p.qtd}" min="1" oninput="updProd(${p.id},'qtd',this.value)"/>
      <input class="prod-input" type="text" placeholder="Nome do produto" value="${p.nome}" oninput="updProd(${p.id},'nome',this.value)"/>
      <button class="btn-del-prod" onclick="remProd(${p.id})">‚úï</button>
    </div>`).join('');
}
function selPgto(btn,val){
  R('pgtoChips').querySelectorAll('.chip').forEach(b=>b.classList.remove('sel-blue','sel-teal','sel-purple'));
  btn.classList.add('sel-blue');
  pgto=val; R('pgtoCustom').value=''; atualizarMsg();
}
function selMidia(btn,val){
  R('midiaChips').querySelectorAll('.chip').forEach(b=>b.classList.remove('sel-blue','sel-teal','sel-purple'));
  btn.classList.add('sel-purple');
  midia=val; atualizarMsg();
}
function atualizarMsg(){
  const entrega = R('entrega').value||'___';
  const valor   = R('msgValor').value;
  const sistema = R('msgSistema').value;
  const custom  = R('pgtoCustom').value.trim();
  const pf      = custom||pgto;
  const linhas  = prods.filter(p=>p.nome&&p.nome.trim())
    .map(p=>`üîπ${String(p.qtd||'01').padStart(2,'0')}- ${p.nome.trim().toUpperCase()}`)
    .join('\n')||'üîπ(adicione os produtos acima)';
  const msg=`ATACAD√ÉO DO SONO\n‚ö´Produto:\n${linhas}\n‚ö´Pagamento:   \n       \n  \n   -   ${pf}\nüìçDia da entrega: ${entrega.toUpperCase()}\nüí∞Valor: ${numBrl(valor)}\nüí± SISTEMA: ${numBrl(sistema)}\n \n‚óºÔ∏èM√≠dia: ${midia}`;
  R('msgPreview').textContent=msg;
}

function preencherMensagem(desc, valor){
  // Entrega: sempre "FOI HOJE" para vendas do dia (sobrescreve pois √© certeza)
  R('entrega').value = 'FOI HOJE';

  // Valor: preenche com o valor da venda lan√ßada
  R('msgValor').value = valor;

  // Sistema: deixa vazio para preencher manualmente (voc√™ sabe o valor do sistema)
  // Pagamento e M√≠dia: mant√©m o que j√° estava selecionado (padr√£o BLU 10X / ENTROU E COMPROU)

  atualizarMsg();

  // Pisca aba Mensagem para avisar que est√° pronta para completar os produtos
  setTimeout(()=>{
    const tab = R('tab-mensagem');
    tab.style.transition = 'all 0.3s';
    tab.style.background = 'rgba(20,184,166,0.3)';
    tab.style.color = '#5eead4';
    setTimeout(()=>{
      tab.style.background = '';
      tab.style.color = '';
    }, 1800);
  }, 200);
}
function copiarMsg(){
  const txt=R('msgPreview').textContent;
  const btn=R('btnCopiar');
  const ok=()=>{
    btn.innerHTML=`<svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg> Copiado!`;
    btn.classList.add('copiado');
    setTimeout(()=>{btn.innerHTML=`<svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copiar`;btn.classList.remove('copiado');},3000);
  };
  if(navigator.clipboard) navigator.clipboard.writeText(txt).then(ok).catch(()=>fallback(txt,ok));
  else fallback(txt,ok);
}

function enviarWhatsapp(){
  const txt = R('msgPreview').textContent;
  if(!txt || txt.includes('adicione os produtos acima')){
    toast('‚ö†Ô∏è Preencha os produtos antes de enviar!','warning'); return;
  }
  // Abre WhatsApp com a mensagem ‚Äî sem n√∫mero fixo, o app abre a tela de sele√ß√£o de contato
  const url = 'https://wa.me/?text=' + encodeURIComponent(txt);
  window.open(url, '_blank');
}
function fallback(txt,cb){
  const el=document.createElement('textarea');
  el.value=txt;el.style.cssText='position:fixed;opacity:0';
  document.body.appendChild(el);el.select();
  try{document.execCommand('copy');cb();}catch(e){}
  document.body.removeChild(el);
}
function limparMsg(){
  if(!window.confirm('Limpar todos os campos da mensagem?')) return;
  prods=[];pid=0;renderProds();
  ['entrega','msgValor','msgSistema','pgtoCustom'].forEach(id=>R(id).value='');
  pgto='BLU 10X';midia='ENTROU E COMPROU';
  R('pgtoChips').querySelectorAll('.chip').forEach(b=>{b.classList.remove('sel-blue','sel-teal','sel-purple');if(b.textContent==='BLU 10X')b.classList.add('sel-blue');});
  R('midiaChips').querySelectorAll('.chip').forEach(b=>{b.classList.remove('sel-blue','sel-teal','sel-purple');if(b.textContent==='ENTROU E COMPROU')b.classList.add('sel-purple');});
  atualizarMsg();
  addProd('01','');addProd('01','');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TECLADO / ACESSIBILIDADE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
R('overlay').addEventListener('click',e=>{if(e.target===R('overlay'))fecharModal();});
R('overlayFechar').addEventListener('click',e=>{if(e.target===R('overlayFechar'))fecharModalFechar();});
R('overlayApagar').addEventListener('click',e=>{if(e.target===R('overlayApagar'))fecharModalApagar();});
R('overlayEditHist').addEventListener('click',e=>{if(e.target===R('overlayEditHist'))fecharEditHist();});
R('overlayApagarHist').addEventListener('click',e=>{if(e.target===R('overlayApagarHist'))fecharApagarHist();});
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){ fecharModal(); fecharModalFechar(); fecharModalApagar(); fecharEditHist(); fecharApagarHist(); cancelarEditFutura(); }
  if(e.key==='Enter'&&R('panel-somador').classList.contains('active')&&!R('overlay').classList.contains('show')&&!R('overlayFechar').classList.contains('show')&&!R('overlayApagar').classList.contains('show'))
    adicionarVenda();
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VENDAS FUTURAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const FUTURAS_KEY = 'atacadao_futuras_v1';
let futurasEditIdx = null;
let futrasFiltroAtivo = 'todos';

function loadFuturas(){ try{ return JSON.parse(localStorage.getItem(FUTURAS_KEY)||'[]'); }catch(e){ return []; } }
function saveFuturas(arr){ localStorage.setItem(FUTURAS_KEY, JSON.stringify(arr)); }

function salvarFutura(){
  const cliente  = R('futCliente').value.trim();
  const produtos = R('futProdutos').value.trim();
  const motivo   = R('futMotivo').value;

  if(!cliente){
    R('futCliente').classList.add('error');
    R('futCliente').focus();
    setTimeout(()=>R('futCliente').classList.remove('error'),800);
    return;
  }
  if(!produtos){
    R('futProdutos').classList.add('error');
    R('futProdutos').focus();
    setTimeout(()=>R('futProdutos').classList.remove('error'),800);
    return;
  }

  const arr = loadFuturas();
  const isEdicao = futurasEditIdx !== null;
  const obj = {
    cliente,
    produtos,
    prazo:     R('futPrazo').value,
    motivo:    motivo,
    obs:       R('futObs').value.trim(),
    entregue:  isEdicao ? (arr[futurasEditIdx].entregue||false) : false,
    entregueEm: isEdicao ? (arr[futurasEditIdx].entregueEm||null) : null,
    criado:    isEdicao ? (arr[futurasEditIdx].criado||new Date().toISOString()) : new Date().toISOString()
  };

  if(isEdicao){ arr[futurasEditIdx] = obj; }
  else { arr.push(obj); }
  saveFuturas(arr);

  R('futCliente').value=''; R('futProdutos').value='';
  R('futPrazo').value=''; R('futMotivo').value=''; R('futObs').value='';
  R('futBtnTxt').textContent = 'Adicionar Venda Futura';
  futurasEditIdx = null;

  renderFuturas();
  toast(isEdicao ? 'Venda futura atualizada!' : 'Venda futura salva!');
}

function editarFutura(idx){
  const arr = loadFuturas();
  const v = arr[idx];
  futurasEditIdx = idx;
  R('futCliente').value  = v.cliente||'';
  R('futProdutos').value = v.produtos||'';
  R('futPrazo').value    = v.prazo||'';
  R('futMotivo').value   = v.motivo||'';
  R('futObs').value      = v.obs||'';
  R('futBtnTxt').textContent = 'Salvar Edi√ß√£o';
  R('panel-futuras').querySelector('.card').scrollIntoView({behavior:'smooth',block:'start'});
  renderFuturas();
}

function cancelarEditFutura(){
  if(futurasEditIdx === null) return;
  futurasEditIdx = null;
  R('futCliente').value=''; R('futProdutos').value=''; R('futPrazo').value='';
  R('futMotivo').value=''; R('futObs').value='';
  R('futBtnTxt').textContent = 'Adicionar Venda Futura';
  renderFuturas();
}

function confirmarEntrega(idx){
  const arr = loadFuturas();
  arr[idx].entregue   = true;
  arr[idx].entregueEm = new Date().toISOString();
  saveFuturas(arr);
  renderFuturas();
  toast('Entrega confirmada!');
}

function desfazerEntrega(idx){
  const arr = loadFuturas();
  arr[idx].entregue   = false;
  arr[idx].entregueEm = null;
  saveFuturas(arr);
  renderFuturas();
  toast('Entrega desfeita','warning');
}

function excluirFutura(idx){
  const arr = loadFuturas();
  const v = arr[idx];
  if(!window.confirm(`Excluir a venda de "${v.cliente}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) return;
  arr.splice(idx,1);
  saveFuturas(arr);
  if(futurasEditIdx === idx) cancelarEditFutura();
  renderFuturas();
  toast('Venda futura removida','warning');
}

function filtrarFuturas(filtro, el){
  futrasFiltroAtivo = filtro;
  document.querySelectorAll('.fut-filtro').forEach(b=>b.classList.remove('active'));
  if(el) el.classList.add('active');
  renderFuturas();
}

function renderFuturas(){
  const arr = loadFuturas();
  const pendentes  = arr.filter(v=>!v.entregue);
  const entregues  = arr.filter(v=>v.entregue);
  const qtdCasa    = pendentes.filter(v=>v.motivo==='casa').length;
  const qtdPrazo   = pendentes.filter(v=>v.motivo==='prazo').length;

  R('futTotalQtd').textContent  = pendentes.length;
  R('futTotalProx').textContent = pendentes.length===1?'1 pendente':`${pendentes.length} pendentes`;
  R('futQtdCasa').textContent   = qtdCasa;
  R('futQtdPrazo').textContent  = `${qtdPrazo} fabricando`;

  const el        = R('fut-lista');
  const filtro    = futrasFiltroAtivo;
  const hoje_str  = dataHoje();

  let filtrados;
  if(filtro==='todos')      filtrados = [...arr];
  else if(filtro==='pendentes')  filtrados = arr.filter(v=>!v.entregue);
  else if(filtro==='entregues')  filtrados = arr.filter(v=>v.entregue);
  else filtrados = arr.filter(v=>!v.entregue && v.motivo===filtro);

  filtrados = filtrados
    .map(v=>({...v, realIdx:arr.indexOf(v)}))
    .sort((a,b)=>{
      // entregues v√£o pro final
      if(a.entregue && !b.entregue) return 1;
      if(!a.entregue && b.entregue) return -1;
      if(!a.prazo && !b.prazo) return 0;
      if(!a.prazo) return 1;
      if(!b.prazo) return -1;
      return a.prazo.localeCompare(b.prazo);
    });

  if(!filtrados.length){
    const msg = filtro==='entregues' ? 'Nenhuma entrega confirmada ainda.' : 'Nenhuma venda futura aqui.<br>Adicione acima para acompanhar.';
    el.innerHTML=`<div class="lista-empty"><span class="ei"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.3"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span><p>${msg}</p></div>`;
    return;
  }

  const motivoLabels = {casa:'Casa', prazo:'Fabricando', outros:'Outros'};
  const motivoClass  = {casa:'casa', prazo:'prazo', outros:'outros'};

  el.innerHTML = filtrados.map(v=>{
    const idx       = v.realIdx;
    const isEntregue = !!v.entregue;
    const prazoFmt  = v.prazo ? new Date(v.prazo+'T12:00:00').toLocaleDateString('pt-BR') : '‚Äî';
    const badge     = v.motivo && !isEntregue ? `<span class="fut-motivo-badge ${motivoClass[v.motivo]||''}">${motivoLabels[v.motivo]||v.motivo}</span>` : '';
    const entBadge  = isEntregue ? `<span class="fut-entregue-badge" style="display:inline-flex"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg> Entregue</span>` : '';
    const entregueEmFmt = v.entregueEm ? new Date(v.entregueEm).toLocaleDateString('pt-BR') : '';

    let prazoClass = '', prazoLabel = prazoFmt;
    if(v.prazo && !isEntregue){
      const diff = Math.ceil((new Date(v.prazo+'T12:00:00') - new Date(hoje_str+'T12:00:00')) / 86400000);
      if(diff < 0)       { prazoClass='fut-prazo-urgente'; prazoLabel=`${prazoFmt} ¬∑ ${Math.abs(diff)}d atraso`; }
      else if(diff===0)  { prazoClass='fut-prazo-urgente'; prazoLabel='Hoje'; }
      else if(diff<=3)   { prazoClass='fut-prazo-urgente'; prazoLabel=`${prazoFmt} ¬∑ ${diff}d`; }
      else               { prazoLabel=prazoFmt; }
    }

    const obs = v.obs ? `<div class="fut-meta-item"><strong>${esc(v.obs)}</strong></div>` : '';
    const editandoStyle = futurasEditIdx===idx ? 'border-color:rgba(124,156,191,0.45);background:rgba(124,156,191,0.05)' : '';
    const cardClass = isEntregue ? ' entregue' : '';

    // A√ß√µes conforme estado
    const acoes = isEntregue
      ? `<button class="btn-desfazer" onclick="desfazerEntrega(${idx})">
           <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3.48"/></svg>
           Desfazer
         </button>
         <button class="btn-sm del" onclick="excluirFutura(${idx})">
           <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
         </button>`
      : `<button class="btn-confirmar" onclick="confirmarEntrega(${idx})">
           <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
           Confirmar Entrega
         </button>
         <button class="btn-sm edit" onclick="editarFutura(${idx})">
           <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
         </button>
         <button class="btn-sm del" onclick="excluirFutura(${idx})">
           <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg>
         </button>`;

    const entregueInfo = isEntregue && entregueEmFmt
      ? `<div class="fut-meta-item" style="color:var(--teal)"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg> <strong>Entregue em ${entregueEmFmt}</strong></div>`
      : `<div class="fut-meta-item ${prazoClass}"><strong>${prazoLabel || '‚Äî'}</strong></div>`;

    return `<div class="fut-card${cardClass}" style="${editandoStyle}">
      <div class="fut-card-top">
        <div class="fut-cliente">${esc(v.cliente)}</div>
        <div style="display:flex;gap:5px;align-items:center;flex-shrink:0">${entBadge}${badge}</div>
      </div>
      <div class="fut-produtos" style="white-space:pre-line">${esc(v.produtos)}</div>
      <div class="fut-meta">
        ${entregueInfo}
        ${obs}
      </div>
      <div class="fut-card-actions">${acoes}</div>
    </div>`;
  }).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INSIGHTS DO M√äS + TERM√îMETRO (CONFIGUR√ÅVEL)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const CFG_KEY = 'atac_settings_v1';
let cfg = {
  base: 'comissao',     // comissao | vendas
  meta: 5,              // 5% padr√£o
  excelente: 15,        // "üî•" a partir de 15% (edit√°vel)
  metaMensal: 0,        // meta do m√™s (R$) opcional (na base escolhida)
  showDia: true,
  showSemana: true,
  showPedidos: true,
  showTermo: true,
  showCacador: true,
};

function loadCfg(){
  try{
    const raw = localStorage.getItem(CFG_KEY);
    if(raw) cfg = { ...cfg, ...JSON.parse(raw) };
  }catch(e){}
}
function saveCfg(){
  localStorage.setItem(CFG_KEY, JSON.stringify(cfg));
}

function abrirConfig(){
  loadCfg();
  R('cfgBase').value = cfg.base;
  R('cfgMeta').value = cfg.meta;
  R('cfgExcelente').value = cfg.excelente;
  if(R('cfgMetaMensal')) R('cfgMetaMensal').value = cfg.metaMensal || '';
  if(R('cfgShowCacador')) R('cfgShowCacador').value = cfg.showCacador ? '1' : '0';
  R('cfgShowDia').checked = !!cfg.showDia;
  R('cfgShowSemana').checked = !!cfg.showSemana;
  R('cfgShowPedidos').checked = !!cfg.showPedidos;
  R('cfgShowTermo').checked = !!cfg.showTermo;
  R('overlayCfg').style.display = 'flex';
}
function fecharConfig(){
  R('overlayCfg').style.display = 'none';
}
function salvarConfig(){
  cfg.base = R('cfgBase').value;
  cfg.meta = Number(R('cfgMeta').value || 5);
  cfg.excelente = Number(R('cfgExcelente').value || 15);
  cfg.showDia = R('cfgShowDia').checked;
  cfg.showSemana = R('cfgShowSemana').checked;
  cfg.showPedidos = R('cfgShowPedidos').checked;
  cfg.showTermo = R('cfgShowTermo').checked;
  saveCfg();
  fecharConfig();
  renderInsightsMes();
  applyCacadorVisibility();
  // se estiver na aba Ca√ßador, atualiza imediatamente
  if(R('tab-cacador') && R('tab-cacador').classList.contains('active')) hunterRender();
  toast('Ajustes salvos ‚úÖ');
}

function ymdLocal(dt){
  const y = dt.getFullYear();
  const m = String(dt.getMonth()+1).padStart(2,'0');
  const d = String(dt.getDate()).padStart(2,'0');
  return `${y}-${m}-${d}`;
}
function diasNoMes(ano, mes1a12){
  return new Date(ano, mes1a12, 0).getDate();
}
function somaComissao(v){
  return arred(v.valor * v.comissao / 100);
}
function vendasDoMes(ano, mes1a12){
  const hist = loadHist();
  const mm = String(mes1a12).padStart(2,'0');
  const prefixo = `${ano}-${mm}`;
  let itens = [];

  // hist√≥rico
  Object.keys(hist).forEach(k=>{
    if(k.startsWith(prefixo) && hist[k] && Array.isArray(hist[k].itens)){
      hist[k].itens.forEach(v=> itens.push(v));
    }
  });

  // dia aberto (hoje)
  if(hoje && Array.isArray(hoje.itens)){
    hoje.itens.forEach(v=>{
      const d = new Date(v.ts);
      if(d.getFullYear()===ano && (d.getMonth()+1)===mes1a12) itens.push(v);
    });
  }
  return itens;
}

function renderInsightsMes(){
  loadCfg();

  const wrap = R('insightsWrap');
  if(!wrap) return;

  const agora = new Date();
  const ano = agora.getFullYear();
  const mes = agora.getMonth()+1;

  const itens = vendasDoMes(ano, mes);
  if(!itens.length){
    wrap.style.display = 'none';
    return;
  }
  wrap.style.display = 'block';

  // Mostrar/ocultar cards conforme config
  R('cardMelhorDia').style.display    = cfg.showDia ? 'block' : 'none';
  R('cardMelhorSemana').style.display = cfg.showSemana ? 'block' : 'none';
  R('cardTotalPedidos').style.display = cfg.showPedidos ? 'block' : 'none';
  R('cardTermometro').style.display   = cfg.showTermo ? 'block' : 'none';

  // Total pedidos
  const totalPedidos = itens.length;
  R('tpTotal').textContent = totalPedidos;
  R('tpInfo').textContent  = totalPedidos===1 ? '1 pedido no m√™s' : `${totalPedidos} pedidos no m√™s`;

  // Melhor dia do m√™s
  const porDia = {};
  itens.forEach(v=>{
    const dt = new Date(v.ts);
    const key = ymdLocal(dt);
    if(!porDia[key]) porDia[key] = { total:0, qtd:0, com:0 };
    porDia[key].total += v.valor;
    porDia[key].qtd   += 1;
    porDia[key].com   += somaComissao(v);
  });
  let melhorDiaKey = Object.keys(porDia)[0];
  Object.keys(porDia).forEach(k=>{
    if(porDia[k].total > porDia[melhorDiaKey].total) melhorDiaKey = k;
  });
  const md = porDia[melhorDiaKey];
  R('mdData').textContent = fmtData(melhorDiaKey);
  R('mdInfo').textContent = `${brl(arred(md.total))} ‚Ä¢ ${md.qtd} pedido(s) ‚Ä¢ comiss√£o ${brl(arred(md.com))}`;

  // Melhor semana (1‚Äì7, 8‚Äì14, 15‚Äì21, 22‚Äì28, 29‚Äìfim)
  const maxDia = diasNoMes(ano, mes);
  const porSemana = {
    1:{total:0,qtd:0,com:0},
    2:{total:0,qtd:0,com:0},
    3:{total:0,qtd:0,com:0},
    4:{total:0,qtd:0,com:0},
    5:{total:0,qtd:0,com:0},
  };
  itens.forEach(v=>{
    const dt = new Date(v.ts);
    const d  = dt.getDate();
    const w  = Math.ceil(d/7);
    porSemana[w].total += v.valor;
    porSemana[w].qtd   += 1;
    porSemana[w].com   += somaComissao(v);
  });
  let melhorSemana = 1;
  for(let w=2; w<=5; w++){
    if(porSemana[w].total > porSemana[melhorSemana].total) melhorSemana = w;
  }
  const sIni = (melhorSemana-1)*7 + 1;
  const sFim = Math.min(melhorSemana*7, maxDia);
  const ms = porSemana[melhorSemana];
  R('msSemana').textContent = `Dias ${String(sIni).padStart(2,'0')}‚Äì${String(sFim).padStart(2,'0')}`;
  R('msInfo').textContent   = `${brl(arred(ms.total))} ‚Ä¢ ${ms.qtd} pedido(s) ‚Ä¢ comiss√£o ${brl(arred(ms.com))}`;

  // Term√¥metro: m√™s atual vs m√™s anterior
  const mesAntDate = new Date(ano, mes-2, 1);
  const anoAnt = mesAntDate.getFullYear();
  const mesAnt = mesAntDate.getMonth()+1;

  const itensAnt = vendasDoMes(anoAnt, mesAnt);

  const somaBase = (arr)=>{
    let v=0,c=0;
    arr.forEach(x=>{ v+=x.valor; c+=somaComissao(x); });
    return { vendas: arred(v), comissao: arred(c) };
  };

  const cur  = somaBase(itens);
  const prev = somaBase(itensAnt);

  const baseLabel = (cfg.base==='comissao') ? 'Comiss√£o' : 'Vendas';
  const curVal  = (cfg.base==='comissao') ? cur.comissao  : cur.vendas;
  const prevVal = (cfg.base==='comissao') ? prev.comissao : prev.vendas;

  let pct;
  if(prevVal > 0) pct = ((curVal - prevVal) / prevVal) * 100;
  else pct = (curVal > 0) ? 999 : 0;

  let status = 'yellow';
  let texto  = `Na faixa (¬±${cfg.meta}%)`;

  if(prevVal === 0 && curVal > 0){
    status='fire';
    texto='Sem base no m√™s anterior';
  } else if(pct >= cfg.excelente){
    status='fire';
    texto=`Excelente (>= ${cfg.excelente}%)`;
  } else if(pct >= cfg.meta){
    status='green';
    texto=`Bom (>= ${cfg.meta}%)`;
  } else if(pct <= -cfg.meta){
    status='red';
    texto=`Queda (<= -${cfg.meta}%)`;
  }

  const pctTxt = (prevVal===0 && curVal>0) ? '‚ñ≤' : `${pct>=0?'+':''}${pct.toFixed(1)}%`;
  R('tmValor').textContent = `${pctTxt} ‚Ä¢ ${baseLabel}`;
  R('tmInfo').textContent  = `${texto} ‚Ä¢ agora: ${brl(curVal)} | antes: ${brl(prevVal)}`;

  R('segRed').classList.toggle('active', status==='red');
  R('segYellow').classList.toggle('active', status==='yellow');
  R('segGreen').classList.toggle('active', status==='green');
  R('segFire').classList.toggle('active', status==='fire');
}

// ‚îÄ‚îÄ CA√áADOR DE COMISS√ÉO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyCacadorVisibility(){
  const show = !!cfg.showCacador;
  const tab = R('tab-cacador');
  const panel = R('panel-cacador');
  if(tab) tab.style.display = show ? '' : 'none';
  if(panel) panel.style.display = show ? '' : 'none';
  // se desativou e estava na aba, volta pra vendas
  if(!show){
    const isActive = tab && tab.classList.contains('active');
    if(isActive) mudarAba('somador');
  }
}

function hunterNivelPorPct(pct){
  if(pct >= cfg.excelente) return {t:'üëë Elite', s:`Excelente (>= ${cfg.excelente}%)`};
  if(pct >= cfg.meta)      return {t:'üî• Dominando', s:`Bom (>= ${cfg.meta}%)`};
  if(pct >= 0)             return {t:'üü¢ Crescendo', s:`Acima de 0%`};
  if(pct >= -cfg.meta)     return {t:'üü° Est√°vel', s:`Dentro de ¬±${cfg.meta}%`};
  return {t:'üî¥ Sobrevivendo', s:`Queda (<= -${cfg.meta}%)`};
}

function hunterCalcPct(curVal, prevVal){
  if(prevVal > 0) return ((curVal - prevVal) / prevVal) * 100;
  if(curVal > 0) return 999;
  return 0;
}

function hunterRender(){
  loadCfg();
  applyCacadorVisibility();
  if(!cfg.showCacador) return;

  const agora = new Date();
  const ano = agora.getFullYear();
  const mes = agora.getMonth()+1;

  const itens = vendasDoMes(ano, mes);
  const mesAntDate = new Date(ano, mes-2, 1);
  const anoAnt = mesAntDate.getFullYear();
  const mesAnt = mesAntDate.getMonth()+1;
  const itensAnt = vendasDoMes(anoAnt, mesAnt);

  const somaBase = (arr)=>{
    let v=0,c=0;
    arr.forEach(x=>{ v+=x.valor; c+=somaComissao(x); });
    return { vendas: arred(v), comissao: arred(c), qtd: arr.length };
  };
  const cur = somaBase(itens);
  const prev = somaBase(itensAnt);

  const baseLabel = (cfg.base==='comissao') ? 'comiss√£o' : 'vendas';
  const curVal = (cfg.base==='comissao') ? cur.comissao : cur.vendas;
  const prevVal = (cfg.base==='comissao') ? prev.comissao : prev.vendas;

  const pct = hunterCalcPct(curVal, prevVal);
  const nivel = hunterNivelPorPct(pct);

  // NIVEL
  R('hunterLevel').textContent = nivel.t;
  const pctTxt = (prevVal===0 && curVal>0) ? '‚ñ≤' : `${pct>=0?'+':''}${pct.toFixed(1)}%`;
  R('hunterLevelSub').textContent = `Desempenho: ${pctTxt} (${baseLabel}) ¬∑ ${nivel.s}`;

  // MISS√ÉO (prioridade: metaMensal, sen√£o crescimento vs m√™s anterior)
  const diasNoMesAtual = diasNoMes(ano, mes);
  const diaHoje = agora.getDate();
  const diasRestantes = Math.max(0, diasNoMesAtual - diaHoje);

  let alvo = 0;
  let modo = '';
  if(cfg.metaMensal && cfg.metaMensal > 0){
    alvo = cfg.metaMensal;
    modo = `Meta mensal configurada`;
  }else if(prevVal > 0){
    alvo = prevVal * (1 + (cfg.meta/100));
    modo = `Meta: +${cfg.meta}% vs m√™s anterior`;
  }else{
    // sem base: usa uma meta leve baseada na m√©dia atual + crescimento
    const mediaAtual = curVal / Math.max(1, diaHoje);
    alvo = mediaAtual * diasNoMesAtual * 1.05;
    modo = `Meta sugerida (sem base anterior)`;
  }

  const falta = Math.max(0, arred(alvo - curVal));
  const mediaNec = diasRestantes > 0 ? (falta / diasRestantes) : falta;

  // estimativa de "quantas vendas" pelo ticket m√©dio
  const ticketMedio = cur.qtd>0 ? (cur.vendas / cur.qtd) : 0;
  const vendasNec = ticketMedio > 0 ? Math.ceil((cfg.base==='comissao' ? (mediaNec / ( (cur.comissao/Math.max(1,cur.vendas)) || 0.05 )) : mediaNec) / ticketMedio) : 0;

  if(falta <= 0){
    R('hunterMissionTitle').textContent = `Meta batida ‚úÖ`;
    R('hunterMissionSub').textContent = `${modo} ¬∑ Voc√™ j√° passou do alvo (${brl(curVal)}).`;
  }else{
    R('hunterMissionTitle').textContent = `Faltam ${brl(falta)} (${baseLabel})`;
    const porDiaTxt = diasRestantes>0 ? `${brl(arred(mediaNec))} por dia (restam ${diasRestantes} dias)` : `hoje √© o √∫ltimo dia do m√™s`;
    const extra = (ticketMedio>0 && vendasNec>0) ? ` ¬∑ Aproximadamente ${vendasNec} pedidos m√©dios/dia` : '';
    R('hunterMissionSub').textContent = `${modo} ¬∑ ${porDiaTxt}${extra}`;
  }

  // RADAR: melhor dia da semana no m√™s atual e desafio se hoje for dia fraco
  const dias = {
    0:{total:0,qtd:0},1:{total:0,qtd:0},2:{total:0,qtd:0},3:{total:0,qtd:0},4:{total:0,qtd:0},5:{total:0,qtd:0},6:{total:0,qtd:0}
  };
  itens.forEach(v=>{
    const dw = new Date(v.ts).getDay();
    dias[dw].total += v.valor;
    dias[dw].qtd += 1;
  });
  const nomes = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];
  let best=0, worst=0;
  for(let i=1;i<7;i++){
    if(dias[i].total > dias[best].total) best=i;
    if(dias[i].total < dias[worst].total) worst=i;
  }
  const hojeDw = agora.getDay();
  const bestTxt = `${nomes[best]} (m√™s: ${brl(arred(dias[best].total))})`;
  const worstTxt = `${nomes[worst]} (m√™s: ${brl(arred(dias[worst].total))})`;

  let radarMsg = `Seu melhor dia (at√© agora): ${bestTxt}. Seu dia mais fraco: ${worstTxt}.`;
  if(hojeDw === worst && dias[worst].qtd>0){
    radarMsg += ` Hoje √© ${nomes[hojeDw]} ‚Äî miss√£o b√¥nus: quebrar o padr√£o e subir o volume.`;
  }else if(hojeDw === best && dias[best].qtd>0){
    radarMsg += ` Hoje √© ${nomes[hojeDw]} ‚Äî aproveite seu dia forte e busque ticket alto.`;
  }else{
    radarMsg += ` Hoje √© ${nomes[hojeDw]} ‚Äî foque em consist√™ncia e no ticket m√©dio.`;
  }
  if(cur.qtd>0){
    radarMsg += ` Ticket m√©dio do m√™s: ${brl(arred(ticketMedio))}.`;
  }
  R('hunterRadar').textContent = radarMsg;
}

function hunterSimular(){
  loadCfg();
  const v = Number(R('hunterSimValor').value || 0);
  const pctVenda = Number(R('hunterSimPct').value || 5);
  if(!v || v<=0){
    toast('Informe um valor v√°lido para simular.');
    return;
  }

  const agora = new Date();
  const ano = agora.getFullYear();
  const mes = agora.getMonth()+1;

  const itens = vendasDoMes(ano, mes);
  const mesAntDate = new Date(ano, mes-2, 1);
  const anoAnt = mesAntDate.getFullYear();
  const mesAnt = mesAntDate.getMonth()+1;
  const itensAnt = vendasDoMes(anoAnt, mesAnt);

  const somaBase = (arr)=>{
    let vv=0,cc=0;
    arr.forEach(x=>{ vv+=x.valor; cc+=somaComissao(x); });
    return { vendas: arred(vv), comissao: arred(cc) };
  };
  const cur = somaBase(itens);
  const prev = somaBase(itensAnt);

  const addCom = arred(v * (pctVenda/100));

  const curVal = (cfg.base==='comissao') ? cur.comissao : cur.vendas;
  const prevVal = (cfg.base==='comissao') ? prev.comissao : prev.vendas;

  const novoCurVal = (cfg.base==='comissao') ? arred(cur.comissao + addCom) : arred(cur.vendas + v);

  const pctAntes = hunterCalcPct(curVal, prevVal);
  const pctDepois = hunterCalcPct(novoCurVal, prevVal);

  const nivelDepois = hunterNivelPorPct(pctDepois);

  R('hunterSimOut').textContent =
    `+${brl(v)} agora ‚Üí +${brl(addCom)} comiss√£o ¬∑ ${cfg.base==='comissao' ? `comiss√£o do m√™s ${brl(novoCurVal)}` : `vendas do m√™s ${brl(novoCurVal)}`}`;

  const aTxt = (prevVal===0 && curVal>0) ? '‚ñ≤' : `${pctAntes>=0?'+':''}${pctAntes.toFixed(1)}%`;
  const dTxt = (prevVal===0 && novoCurVal>0) ? '‚ñ≤' : `${pctDepois>=0?'+':''}${pctDepois.toFixed(1)}%`;
  R('hunterSimOut2').textContent = `De ${aTxt} ‚Üí ${dTxt} ¬∑ n√≠vel: ${nivelDepois.t}`;

  R('hunterSimBox').style.display='block';
}

function hunterLimparSim(){
  R('hunterSimValor').value='';
  R('hunterSimPct').value='5';
  R('hunterSimBox').style.display='none';
}
</script>
</body>
</html>
